"use strict";angular.module("regCartApp",["configuration","ngAnimate","ngCookies","ngResource","ngSanitize","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){b.otherwise("/myCart");var d={templateUrl:"partials/cart.html",controller:"CartCtrl"},e={templateUrl:"partials/schedule.html",controller:"ScheduleCtrl"};a.state("root",{"abstract":!0,url:"?term",views:{root:{templateUrl:"partials/main.html",controller:"MainCtrl"}}}).state("root.schedule",{url:"/mySchedule",views:{"":e,mycart:d,schedule:e}}).state("root.cart",{url:"/myCart",views:{"":e,mycart:d,schedule:e}}).state("root.search",{url:"/search?page&displayLimit&predicate&reverse&filters",views:{"":{templateUrl:"partials/search.html"},mycart:d,schedule:e}}).state("root.search.results",{url:"/{searchCriteria}",views:{"":{templateUrl:"partials/searchResults.html",controller:"SearchCtrl"}}}).state("root.search.details",{url:"/{searchCriteria}/{code}/{id}?regGroupId",templateUrl:"partials/searchDetails.html",controller:"SearchDetailsCtrl"}),c.interceptors.push("loginInterceptor")}]),angular.module("configuration",[]).value("APP_URL","ks-with-rice-bundled-dev/services/").value("DEFAULT_TERM","kuali.atp.2012Fall").value("FEATURE_TOGGLES",{}),angular.module("regCartApp").constant("URLS",{scheduleOfClasses:"ScheduleOfClassesClientService",courseRegistration:"CourseRegistrationClientService",courseRegistrationCart:"CourseRegistrationCartClientService",developmentLogin:"DevelopmentLoginClientService"}).constant("STATE",function(){var a={failed:"kuali.lpr.trans.state.failed",processing:"kuali.lpr.trans.state.processing",succeeded:"kuali.lpr.trans.state.succeeded",item:{failed:"kuali.lpr.trans.item.state.failed",processing:"kuali.lpr.trans.item.state.processing",succeeded:"kuali.lpr.trans.item.state.succeeded",waitlist:"kuali.lpr.trans.item.state.waitlist",waitlistActionAvailable:"kuali.lpr.trans.item.state.waitlistActionAvailable"}};return{lpr:a,action:[a.item.waitlistActionAvailable],error:[a.failed,a.item.failed],processing:[a.processing,a.item.processing],success:[a.succeeded,a.item.succeeded],waitlist:[a.item.waitlist]}}()).constant("STATUS",{action:"action",editing:"editing",error:"error",info:"info","new":"new",processing:"processing",success:"success",waitlist:"waitlist"}).constant("COURSE_TYPES",{registered:"registered",waitlisted:"waitlist",cart:"cart"}).constant("GRADING_OPTION",{audit:"kuali.resultComponent.grade.audit",letter:"kuali.resultComponent.grade.letter",passFail:"kuali.resultComponent.grade.passFail"}).constant("ACTION_LINK",{removeItemFromCart:"removeItemFromCart",undoDeleteCourse:"undoDeleteCourse"}).constant("VALIDATION_ERROR_TYPE",{maxCredits:"kuali.lpr.trans.message.credit.load.exceeded",timeConflict:"kuali.lpr.trans.message.time.conflict",reggroupNotOffered:"kuali.lpr.trans.message.reggroup.notoffered",waitlistAvailable:"kuali.lpr.trans.message.waitlist.available",waitlistWaitlisted:"kuali.lpr.trans.message.waitlist.waitlisted",waitlistFull:"kuali.lpr.trans.message.waitlist.full",waitlistNotOffered:"kuali.lpr.trans.message.waitlist.not.offered",transactionException:"kuali.lpr.trans.message.exception",transactionItemException:"kuali.lpr.trans.item.message.exception",courseNotOpen:"kuali.lpr.trans.message.course.not.open",courseNotOpenEarly:"kuali.lpr.trans.message.course.not.open.early",courseNotOpenLate:"kuali.lpr.trans.message.course.not.open.late",dropPeriodClosed:"kuali.lpr.trans.message.drop.period.closed",editPeriodClosed:"kuali.lpr.trans.message.edit.period.closed",courseGradeIncomplete:"kuali.lpr.trans.message.course.grade.incomplete",courseAlreadyTaken:"kuali.lpr.trans.message.course.already.taken",repeatabilityWarning:"kuali.lpr.trans.message.repeatability.warning"}).constant("GENERAL_ERROR_TYPE",{noRegGroup:"noRegGroup",courseNotFound:"kuali.cr.cart.message.course.code.not.found"}).constant("VALIDATION_SUCCESS_TYPE",{waitlistStudentRemoved:"kuali.lpr.trans.message.waitlist.student.removed",waitlistUpdated:"kuali.lpr.trans.message.waitlist.options.updated",courseUpdated:"kuali.lpr.trans.message.course.updated",courseDropped:"kuali.lpr.trans.message.course.dropped",personRegistered:"kuali.lpr.trans.message.person.registered"}).constant("DAY_CONSTANTS",{monday:"M",tuesday:"Tu",wednesday:"W",thursday:"Th",friday:"F",saturday:"Sa",sunday:"Su",dayArray:["M","Tu","W","Th","F","Sa","Su"]}).constant("GRID_CONSTANTS",{defaultStart:420,defaultEnd:1140,defaultBuffer:15}).constant("SEARCH_CRITERIA",{fromSchedule:"fromschedule"}),angular.module("regCartApp").constant("COURSE_DETAILS",{tabs:[{id:"time",selected:!0,name:"Time",fields:["days","time"]},{id:"instr",selected:!1,name:"Instr",fields:["instructor"]},{id:"seatsLoc",selected:!1,name:"Loc/Seats",fields:["location","seatsOpen"],wide:!0}],selectedTab:"time",selectEvent:"toggleAO",fieldOptions:{time:{right:!0},instructor:{block:!0},seatsOpen:{right:!0,append:"&nbsp;available"}},icons:"additionalInfo",getSections:function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c].activity,e=!0,f=0;f<b.length;f++)if(b[f].header===d){e=!1,b[f].details.push(a[c]);break}if(e){var g={header:d,details:[]};g.details.push(a[c]),b.push(g)}}return b},setDefaultField:function(a){for(var b=0;b<a.length;b++)a[b].defaultField=a[b].aoId}}),angular.module("regCartApp").constant("COURSE_SEARCH_FACETS",[{label:"Seats",id:"seatsAvailable",autoCollapse:!1,optionsProvider:function(a){for(var b=0,c=0;c<a.length;c++)a[c].seatsAvailable>0&&b++;var d=[];return b>0&&d.push({label:"Seats available",value:"seatsAvailable",count:b}),d},filter:function(a){return a.seatsAvailable>0}},{label:"Credits",id:"creditOptions",optionsKey:"creditOptions",refine:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=Math.floor(d.value),f=e;e>6&&(e=6,f="6+");for(var g=null,h=0;h<b.length;h++)if(-1!==b[h].value.indexOf(e)){g=b[h];break}null===g?(d.label=f,d.count=0,d.value=[d.value],-1===d.value.indexOf(e)&&d.value.push(e),b.push(d)):(-1===g.value.indexOf(d.value)&&g.value.push(e),g.label=f)}return b}},{label:"Course Level",id:"courseLevel",optionsKey:"courseLevel"},{label:"Course Prefix",id:"coursePrefix",optionsKey:"coursePrefix"}]).factory("CourseSearchFacets",["COURSE_SEARCH_FACETS","SearchFacetService",function(a,b){return b.initFacets(a)}]),angular.module("regCartApp").controller("DirectRegisterCtrl",["$scope","$rootScope","$modalInstance","GRADING_OPTION","STATUS","GlobalVarsService","course",function(a,b,c,d,e,f,g){function h(){var b="";return a.course.gradingOptionId&&a.course.credits?j?k?b="processing":k||(b="results"):b="confirm":b="options",b}function i(b){if(angular.isDefined(b.responseItemResults)){var d=angular.copy(a.course),g=b.responseItemResults[0];switch(d.state=g.state,d.type=g.type,d.status=f.getCorrespondingStatusFromState(g.state),d.statusMessages=g.messages,a.results.push(d),d.status){case e.success:if(angular.isArray(g.messages)&&g.messages.length>0){var h=angular.copy(d);h.status=e.info,a.results.push(h),g.messages.splice(0,g.messages.length)}break;case e.waitlist:case e.action:g.waitlistMessage=f.getCorrespondingMessageFromStatus(g.status)}}k=!1,0===a.results.length&&c.dismiss(b)}console.log(">> DirectRegisterCtrl"),a.course=g,a.results=[],console.log(g);var j=!1,k=!1;a.course.gradingOptionId||1!==Object.keys(a.course.gradingOptions).length||(a.course.gradingOptionId=Object.keys(a.course.gradingOptions)[0]),a.course.credits||1!==a.course.creditOptions.length||(a.course.credits=a.course.creditOptions[0]),a.saveOptions=function(b){b.newGrading&&(a.course.gradingOptionId=b.newGrading),b.newCredits&&(a.course.credits=b.newCredits)},a.confirm=function(){j=!0,a.results.splice(0,a.results.length),k=!0;var c=b.$broadcast("registerForCourse",a.course);c.promise.then(i,i)},a.addCartItemToCart=function(){b.$broadcast("addCourseToCart",a.course)},a.addCartItemToWaitlist=function(){a.result=null,a.course.allowWaitlist=!0,a.confirm()},a.removeCartResultItem=function(){c.close(a.course)},a.cancel=function(){c.dismiss("cancel")},a.showOptions=function(){return"options"===h()},a.showConfirm=function(){return"confirm"===h()},a.showProcessing=function(){return"processing"===h()},a.showResults=function(){return"results"===h()},a.gradingOption=function(){return a.course.gradingOptions[a.course.gradingOptionId]},a.showBadge=function(){return a.course.gradingOptionId!==d.letter||a.course.editGradingOption}}]),angular.module("regCartApp").controller("MainCtrl",["$scope","$window","$location","$state","$modal","APP_URL","DEFAULT_TERM","GlobalVarsService","LoginService","TermsService","ScheduleService","CartService","MessageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){if(a&&(angular.isUndefined(d.params.term)||d.params.term!==a.termCode)){console.log("Persisting term in state: "+a.termCode);var c=angular.copy(d.params);c.term=a.termCode;var e={notify:!1};b&&(e.location="replace"),d.go(d.current.name,c,e).then(function(){p(a)})}}function o(){var b=null;angular.isDefined(d.params.term)&&(b=j.getTermByCode(d.params.term)),null===b?(b=a.term?a.term:j.getTermById(g),n(b,!0)):a.term!==b&&p(b)}function p(b){if(null!==b){var c=a.term?a.term.termId:null;console.log("Syncing with term: "+b.termId),j.setSelectedTerm(b),a.term=b,console.log("- Checking term eligibility"),j.isStudentEligibleForTerm(b).then(function(d,e){a.studentIsEligibleForTerm=d,a.studentIsEligibleForTerm?a.$broadcast("termIdChanged",b.termId,c):e&&h.setUserId(e.userId)},function(b){console.log("Error while checking if term is open for registration",b),a.studentIsEligibleForTerm=!1})}}console.log(">> MainCtrl"),a.appUrl=f.replace("/services/","/"),a.userId=h.getUserId,a.terms=[],a.term=j.getSelectedTerm(),a.studentIsEligibleForTerm=!0,j.getTerms().then(function(b){a.terms=b,o()}),a.$watch("term",function(a,b){a&&a!==b&&(console.log("Term Changed: "+a.termId+", was "+(b?b.termId:null)),n(a))}),a.$on("$stateChangeSuccess",function(){o()}),a.$on("termIdChanged",function(b,c){k.getSchedule(c).then(function(b){console.log("called rest service to get schedule data - in main.js"),k.updateScheduleCounts(b),a.cartCredits=l.getCartCredits,a.cartCourseCount=l.getCartCourseCount,a.registeredCredits=k.getRegisteredCredits,a.registeredCourseCount=k.getRegisteredCourseCount,a.waitlistedCredits=k.getWaitlistedCredits,a.waitlistedCourseCount=k.getWaitlistedCourseCount,a.userId=h.getUserId})}),m.getMessages();var q=function(){console.log("Logging out"),i.logout().query({},function(){var a=c.absUrl();a=a.substring(0,a.indexOf("#")),console.log("- Logged out, redirecting to: "+a),b.location.href=a})};a.logout=q,a.$on("sessionExpired",function(){console.log("Received event sessionExpired"),e.open({backdrop:"static",templateUrl:"sessionExpired.html",controller:["$scope",function(a){a.logout=q}],size:"sm"})}),a.$parent.uiState=d.current.name,a.$on("$stateChangeStart",function(b,c){a.$parent.uiState=c.name}),a.searchForm=function(){var a=!0;return"root.search.details"===d.current.name&&(a=!1),a}}]),angular.module("regCartApp").controller("CartCtrl",["$scope","$modal","$timeout","$q","STATE","STATUS","GRADING_OPTION","ACTION_LINK","COURSE_TYPES","GENERAL_ERROR_TYPE","GlobalVarsService","MessageService","TermsService","CartService","ScheduleService","RegUtil",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(b){n.getCart(b).then(function(b){a.cart=b;var c=[],d=null;angular.forEach(a.cart.items,function(b){if(z(b),k.getCorrespondingStatusFromState(b.state)===f.processing){b.status=f.processing;var g=angular.copy(b);a.cartResults.items.push(g),a.cartResults.state=e.lpr.processing,a.cartResults.status=f.processing,d=b.cartId}else c.push(b)}),a.cart.items=c,null!==d&&s(d)})}function r(b,e){return e=e||d.defer(),a.courseAdded=!1,b.courseCode&&(b.courseCode=b.courseCode.toUpperCase()),n.addCourseToCart().query({cartId:a.cart.cartId,termId:m.getTermId(),courseCode:b.courseCode||null,regGroupCode:b.regGroupCode||null,regGroupId:b.regGroupId||null,gradingOptionId:b.gradingOptionId||null,credits:b.credits||null},function(b){console.log("Searched for course: "+a.courseCode+" "+a.regCode+", Term: "+m.getTermId()),a.courseCode="",a.regCode="",z(b),a.cart.items.unshift(b),console.log("Started to glow..."),b.addingNewCartItem=!0,c(function(){b.addingNewCartItem=!1},2e3),a.courseAdded=!0,e.resolve(b)},function(c){var d;if(404===c.status){if(c.data.messageKey)switch(c.data.messageKey){case j.courseNotFound:d=c.data.courseCode+" does not exist for "+m.getSelectedTerm().termName;break;default:d=l.getMessage(c.data.messageKey)}else d=c.data;a.userMessage={txt:d,messageKey:j.noRegGroup,type:f.error,course:b.courseCode},a.courseAdded=!0,e.reject(a.userMessage)}else 400===c.status?(y(c.data,function(a){r(a,e)}),a.courseAdded=!0):(console.log("Error with adding course",c.data.consoleMessage),d=c.data.genericMessage+" for "+m.getSelectedTerm().termName,a.userMessage={txt:d,messageKey:j.noRegGroup,type:c.data.type,detail:c.data.detailedMessage,course:b.courseCode+" ("+b.regGroupCode+")"},a.courseAdded=!0,e.reject(a.userMessage))}),e.promise}function s(b){o.pollRegistrationRequestStatus(b).then(function(a){console.log("- Stop polling - Success"),t(a)},function(a){console.log("- Stop polling - Error: ",a),t(a)},function(b){console.log("- Continue polling"),a.cart.state=b.state})}function t(b){if(angular.isDefined(b.state)&&(a.cart.state=b.state),a.cart.status="",a.cartResults.state=e.lpr.item.succeeded,angular.isDefined(b.responseItemResults)){var c=[];angular.forEach(b.responseItemResults,function(b){angular.forEach(a.cartResults.items,function(a){if(a.cartItemId===b.registrationRequestItemId)switch(a.state=b.state,a.type=b.type,a.status=k.getCorrespondingStatusFromState(b.state),a.statusMessages=b.messages,a.status){case f.success:if(angular.isArray(b.messages)&&b.messages.length>0){var d=angular.copy(a);d.status=f.info,c.push({oldItem:a,newItem:d})}break;case f.waitlist:case f.action:a.waitlistMessage=k.getCorrespondingMessageFromStatus(a.status)}})});for(var d=0;d<c.length;d++)a.cartResults.items.splice(a.cartResults.items.indexOf(c[d].oldItem)+1,0,c[d].newItem)}u(!0),x()}function u(b){b&&(a.cartResults.successCount=0,a.cartResults.waitlistCount=0,a.cartResults.waitlistedCount=0,a.cartResults.errorCount=0,a.cartResults.infoCount=0);var c=0,d=0,e=0,g=0,h=0;angular.forEach(a.cartResults.items,function(a){switch(a.status){case f.success:c++;break;case f.waitlist:c++,e++;break;case f.action:d++;break;case f.error:g++;break;case f.info:h++}}),a.cartResults.successCount=c,a.cartResults.waitlistCount=d,a.cartResults.waitlistedCount=e,a.cartResults.errorCount=g,a.cartResults.infoCount=h}function v(){if(!a.cart)return 0;for(var b=0,c=0;c<a.cart.items.length;c++)b+=Number(a.cart.items[c].credits);return b}function w(a,b){return b=b||d.defer(),a.credits&&a.gradingOptionId?(o.registerForRegistrationGroup().query({courseCode:a.courseCode||null,regGroupId:a.regGroupId||null,gradingOption:a.gradingOptionId||null,credits:a.credits||null,allowWaitlist:a.allowWaitlist||!1,allowRepeatedCourses:a.allowRepeatedCourses||!1},function(a){o.pollRegistrationRequestStatus(a.id).then(function(a){var c=null;angular.forEach(a.responseItemResults,function(a){null===c&&(c=a.state)}),c===e.lpr.item.failed?b.resolve(a):(x(),b.resolve(a))},function(a){b.reject(a)})},function(a){b.reject(a)}),b.promise):(y(a,function(c){a.gradingOptionId=c.gradingOptionId,a.credits=c.credits,w(a,b)}),b.promise)}function x(){o.getSchedule(m.getTermId(),!0).then(function(b){console.log("Called rest service to get schedule data - in cart.js"),o.updateScheduleCounts(b),a.registeredCredits=o.getRegisteredCredits,a.registeredCourseCount=o.getRegisteredCourseCount})}function y(a,c){b.open({backdrop:"static",templateUrl:"partials/additionalOptions.html",size:"sm",resolve:{item:function(){return a}},controller:["$scope","item",function(a,b){console.log("Controller for modal... Item: ",b),a.newCartItem=b,a.newCartItem.editing=!0,a.dismissAdditionalOptions=function(){console.log("Dismissing credits and grading"),a.$close(!0)};var d=!1;a.saveAdditionalOptions=function(b){d||(d=!0,b.editing=!1,a.newCartItem.credits=a.newCartItem.newCredits,a.newCartItem.gradingOptionId=a.newCartItem.newGrading,c(a.newCartItem),a.$close(!0))}}]})}function z(a){return p.standardizeCartCourse(a)}console.log(">> CartCtrl"),a.states=e,a.statuses=f,a.courseTypes=i,a.oneAtATime=!1,a.isCollapsed=!0,a.cartResults={items:[]},a.$on("termIdChanged",function(b,c){console.log("term id has changed - cart: "+c),a.cartResults.items.splice(0,a.cartResults.items.length),a.userMessage&&a.userMessage.txt&&a.removeUserMessage(),q(c)}),a.$watchCollection("cart.items",function(b){a.creditTotal=v(),b&&n.setCartCredits(a.creditTotal),n.setCartCourses(b)}),m.getTermId()&&q(m.getTermId()),a.courseIndex=function(a){return angular.isDefined(a.index)&&a.index||(a.index=k.getCourseIndex(a)),a.index},a.getStatusMessageFromStatus=function(a){var b="";return a===f.success?b=" - Success!":(a===f.error||a===f.action)&&(b=" - Failed"),b},a.addRegGroupToCart=function(){r({courseCode:a.courseCode,regGroupCode:a.regCode})},a.$on("addCourseToCart",function(a,b){a.promise=r(b)}),a.$on("registerForCourse",function(a,b){a.promise=w(b)}),a.$on("directRegisterForCourse",function(a,c){var d=b.open({backdrop:"static",controller:"DirectRegisterCtrl",windowClass:"kscr-DirectRegister-window",templateUrl:"components/directregister/directRegister.html",size:"sm",resolve:{course:function(){return c}}});a.promise=d.result}),a.addCartItemToCart=function(a){r(a)},a.$on("deleteCartItem",function(b,c){var d=c.actionLinks,e=null;angular.forEach(d,function(a){a.action===h.removeItemFromCart&&(e=a.uri)}),n.removeItemFromCart(e).query({},function(b){console.log("Cart item removed",b),a.cart.items.splice(a.cart.items.indexOf(c),1);var d=null;angular.forEach(b.actionLinks,function(a){a.action===h.undoDeleteCourse&&(d=a.uri)}),a.userMessage={txt:"Removed <b>"+c.courseCode+"("+c.regGroupCode+")</b>",actionLink:d,linkText:"Undo",type:f.success}})}),a.$on("updateCourse",function(b,c,d,e,f,g){c===i.cart&&(console.log("Updating cart item"),n.updateCartItem().query({cartId:a.cart.cartId,cartItemId:d.cartItemId,credits:e.credits,gradingOptionId:e.gradingOptionId},function(){console.log("- Cart item successfully updated"),a.creditTotal=v()-Number(d.credits)+Number(e.credits),angular.isFunction(f)&&f()},function(a){console.log("- Error updating cart item",a),angular.isFunction(g)&&g(a.genericMessage)}))}),a.invokeActionLink=function(b){n.invokeActionLink(b).query({},function(b){z(b),a.cart.items.unshift(b),a.removeUserMessage()})},a.addCartItemToWaitlist=function(a){console.log("Adding cart item to waitlist... "),o.registerForRegistrationGroup().query({courseCode:a.courseCode,regGroupId:a.regGroupId,gradingOption:a.gradingOptionId,credits:a.credits,allowWaitlist:!0},function(b){a.state=e.lpr.item.processing,a.status=f.processing,a.cartItemId=b.registrationRequestItems[0].id,c(function(){console.log("Just waited 250, now start the polling"),s(b.id)},250)})},a.removeAlertMessage=function(a){a.alertMessage=null},a.removeUserMessage=function(){a.userMessage&&(a.userMessage.txt=null,a.userMessage.linkText=null)},a.removeCartResultItem=function(b){a.cartResults.items.splice(b,1),u()},a.register=function(){n.submitCart().query({cartId:a.cart.cartId},function(b){console.log("Submitted cart. RegReqId["+b.id+"]"),a.removeUserMessage(),a.cartResults=angular.copy(a.cart),a.cart.items.splice(0,a.cart.items.length),a.showConfirmation=!1,a.cartResults.state=e.lpr.processing,a.cartResults.status=f.processing,a.creditTotal=0,angular.forEach(a.cartResults.items,function(a){a.state=e.lpr.item.processing,a.status=f.processing}),c(function(){console.log("Just waited 250, now start the polling"),s(b.id)},250)})}}]),angular.module("regCartApp").controller("ScheduleCtrl",["$scope","$modal","$timeout","STATUS","GRADING_OPTION","COURSE_TYPES","GlobalVarsService","TermsService","ScheduleService","CartService",function(a,b,c,d,e,f,g,h,i,j){function k(b,c,d,e,g,h){g(h,function(g){console.log("- Drop course registration request submitted - starting to poll for request status"),i.pollRegistrationRequestStatus(g.id).then(function(){switch(console.log("-- Stop polling - Success"),b){case f.waitlisted:i.removeWaitlistedCourse(c),m++;break;case f.registered:i.removeRegisteredCourse(c),n++}angular.isFunction(d)&&d(),a.$emit("courseDropped",c,b)},function(a){console.log("-- Stop polling - Error",a),angular.isFunction(e)&&e(a.responseItemResults[0].messages)},function(){console.log("-- Continue polling")})},function(a){console.log("- Drop course registration request failed",a),angular.isFunction(e)&&e(a.data)})}function l(a,b,c,d,e,g,h){g(h,function(g){console.log("- Update course registration request submitted - starting to poll for request status"),i.pollRegistrationRequestStatus(g.id).then(function(){switch(console.log("-- Stop polling - Success"),a){case f.waitlisted:i.updateWaitlistedCourse(b,c);break;case f.registered:i.updateRegisteredCourse(b,c)}angular.isFunction(d)&&d()},function(a){console.log("-- Stop polling - Error",a),angular.isFunction(e)&&e(a.responseItemResults[0].messages)},function(){console.log("-- Continue polling")})},function(a){console.log("- Update course registration request failed",a),angular.isFunction(e)&&e(a.data)})}console.log(">> ScheduleCtrl"),a.schedule=i.getSchedule(),a.registeredCredits=i.getRegisteredCredits,a.registeredCourseCount=i.getRegisteredCourseCount,a.waitlistedCredits=i.getWaitlistedCredits,a.waitlistedCourseCount=i.getWaitlistedCourseCount,a.userId=g.getUserId,a.courseTypes=f;var m=0,n=0;a.showWaitlist=function(){return a.waitlistedCredits()>0||m>0},a.showSchedule=function(){return a.showWaitlist()||a.registeredCredits()>0||n>0},a.showGrid=function(){var a=!1;return angular.forEach(j.getCartCourses(),function(b){angular.forEach(b.schedule,function(b){if(!a){var c=b.activityOfferingLocationTime;a=!c.isTBA}})}),a||angular.forEach(i.getScheduledCourses(),function(b){angular.forEach(b.activityOfferings,function(b){if(!a)for(var c=b.scheduleComponents,d=0;d<c.length;d++)if(!c[d].isTBA){a=!0;break}})}),a},a.$on("courseStatusMessageRemoved",function(a,b,c,e){if(angular.isObject(e)&&angular.isDefined(e.action)&&"drop"===e.action&&e.type===d.success)switch(i.spliceCourse(b,c),b){case f.waitlisted:m--;break;case f.registered:n--}}),a.$on("dropCourse",function(a,b,c,d,e){switch(b){case f.waitlisted:console.log("Drop waitlisted course"),k(b,c,d,e,i.dropFromWaitlist().query,{masterLprId:c.masterLprId});break;case f.registered:console.log("Drop registered course"),k(b,c,d,e,i.dropRegistrationGroup().query,{masterLprId:c.masterLprId})}}),a.$on("updateCourse",function(a,b,c,d,e,g){switch(b){case f.waitlisted:console.log("Update waitlisted course"),l(b,c,d,e,g,i.updateWaitlistItem().query,{courseCode:c.courseCode,regGroupId:c.regGroupId,masterLprId:c.masterLprId,termId:h.getTermId(),credits:d.credits,gradingOptionId:d.gradingOptionId});break;case f.registered:console.log("Update registered course"),l(b,c,d,e,g,i.updateScheduleItem().query,{courseCode:c.courseCode,regGroupId:c.regGroupId,masterLprId:c.masterLprId,termId:h.getTermId(),credits:d.credits,gradingOptionId:d.gradingOptionId})}})}]),angular.module("regCartApp").controller("SearchCtrl",["$scope","$filter","$state","$timeout","CourseSearchFacets","TermsService","SearchService",function(a,b,c,d,e,f,g){function h(b){b=b||angular.copy(c.params);for(var d={},e=0;e<a.facets.length;e++){var f=a.facets[e];angular.isArray(f.selectedOptions)&&f.selectedOptions.length>0&&(d[f.id]=f.selectedOptions)}b.filters=Object.keys(d).length>0?JSON.stringify(d):null,c.go("root.search.results",b,{location:"replace",notify:!1})}function i(b){b=b||c.params,a.stateParams=b;var d={};angular.isDefined(b.filters)&&null!==b.filters&&(d=JSON.parse(b.filters)||{});for(var e=0;e<a.facets.length;e++){var f=[],g=a.facets[e];angular.isDefined(d[g.id])&&(f=d[g.id]),g.selectedOptions=f}}function j(){for(var c=b("facetFilter"),d=[],e=0;e<a.searchResults.length;e++)c(a.searchResults[e],a.facets)&&(angular.isUndefined(a.searchResults[e].title)&&(a.searchResults[e].title=l(a.searchResults[e])),d.push(a.searchResults[e]));a.filteredResults=d}function k(b){if(null!==b&&(null===o||b!==o)){if(angular.isFunction(n)&&(n(),n=null),!f.getTermId())return console.log("Search blocked - no termId exists"),void(n=a.$on("termIdChanged",function(){n(),n=null,k(b)}));console.log('Searching for "'+b+'"'),o=b,g.searchForCourses().query({termId:f.getTermId(),criteria:b},function(c){o===b?(console.log('Search for "'+b+'" complete. Results: '+c.length),a.searchResults=c,a.searchCriteria=b,j()):console.log('Search completed but not the most recent, ignoring results: "'+b+'" !== "'+o+'"')},function(a){console.log("Error searching for courses: ",a)})}}function l(a){var b=a.longName;return"CHEM232"===a.courseCode&&console.log("honors flag",a.honors),a.honors&&(console.log("true flag found"),b+='<span class="kscr-SearchDetails-icon--honors" title="Honors Course"></span>',console.log("new title: "+b)),b}console.log(">> SearchCtrl"),a.facets=e,a.searchState=c.params,a.searchCriteria=null,a.searchResults=[],a.filteredResults=[],a.$on("termIdChanged",function(){var b=a.searchCriteria;a.searchCriteria="",a.searchResults=[],b&&(o=null,k(b))}),a.$on("$stateChangeSuccess",function(a,b,c){"root.search.results"===b.name&&(i(c),angular.isDefined(c.searchCriteria)&&k(c.searchCriteria))}),a.$on("resultsStateChanged",function(b,c){var d=angular.copy(c);d.searchCriteria=a.searchCriteria,h(d)});var m;a.$on("facetSelectionChange",function(){m&&d.cancel(m),m=d(function(){j(),h()},20,!1)});var n,o=null;a.$on("viewDetails",function(b,d){c.go("root.search.details",{searchCriteria:a.searchCriteria,id:d.courseId,code:d.courseCode})})}]).filter("startFrom",function(){return function(a,b){return b=+b,a.slice(b)}}).filter("facetFilter",function(){return function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(angular.isArray(d.selectedOptions)&&d.selectedOptions.length>0&&!d.filter(a,d.selectedOptions))return!1}return!0}}),angular.module("regCartApp").controller("SearchDetailsCtrl",["$scope","$rootScope","$state","$filter","$modal","STATUS","SEARCH_CRITERIA","SearchService","CartService","ScheduleService",function(a,b,c,d,e,f,g,h,i,j){function k(b,c){null===b||null!==a.course&&null!==a.course.courseOfferingId&&b===a.course.courseOfferingId&&null!==a.course.courseOfferingCode&&c===a.course.courseOfferingCode||(a.loading=!0,console.log("Loading course "+b+", "+c),w=b,h.getCourse().query({courseOfferingId:b,courseCode:c},function(c){if(w===b){var e={},f={};angular.isDefined(c.activityOfferingTypes)&&angular.isArray(c.activityOfferingTypes)&&angular.forEach(c.activityOfferingTypes,function(b){b.formattedOfferings=d("aoFormatter")(angular.copy(b.activityOfferings)),angular.forEach(b.activityOfferings,function(c){c.activityOfferingType=b.activityOfferingType,f[c.activityOfferingCode]=c,angular.forEach(c.regGroupInfos,function(a,b){angular.isUndefined(e[b])&&(e[b]=a),angular.isUndefined(a.activityOfferingIds)&&(a.activityOfferingIds=[]),e[b].activityOfferingIds.push(c.activityOfferingId)}),(!a.additionalInfo&&(null!==c.subterm||angular.isArray(c.requisites)&&c.requisites.length>0)||"true"===c.honors)&&(a.additionalInfo=!0)}),angular.forEach(b.formattedOfferings,function(a){var b=f[a.aoId];b.flags={},a.flags=b.flags})}),a.availableRegGroups=e,a.aoMap=f,a.loading=!1,a.course=c,a.updateAOStates(),a.singleRegGroup=m()}else a.loading=!1,console.log('Course load completed but not the most recent, ignoring: "'+b+'" !== "'+w+'"')},function(b){a.loading=!1,console.log("Error loading course: ",b)}))}function l(c,d){a.actionType=c,a.actionStatus=null;var e=angular.copy(a.course);e.courseCode=e.courseOfferingCode,e.longName=e.courseOfferingLongName,e.regGroupId=a.selectedRegGroup.regGroupId,e.regGroupCode=a.selectedRegGroup.regGroupCode,e.sourceAction=c,e.activityOfferings=a.selectedAOs;var g=b.$broadcast(d,e);g.promise.then(function(){a.actionStatus=f.success},function(b){"cancel"!==b&&(a.actionStatus=f.error)})}function m(){var b=Object.keys(a.availableRegGroups);if(1===b.length){var c=[];return angular.forEach(a.course.activityOfferingTypes,function(a){angular.forEach(a.activityOfferings,function(a){v(a,!0)}),c.push.apply(c,a.formattedOfferings)}),a.selectedRegGroup=p(),a.singleRegFormatted=c,!0}return!1}function n(){angular.forEach(a.course.activityOfferingTypes,function(b){a.isAOTypeSelected(b)||1!==a.countEligibleAOs(b.activityOfferings)||angular.forEach(b.activityOfferings,function(b){b.flags.selected||b.flags.disabled||(v(b),a.updateAOStates())})})}function o(b){return angular.isDefined(b.isFull)?b:(b.isFull=!1,angular.forEach(a.course.activityOfferingTypes,function(a){b.isFull||angular.forEach(a.activityOfferings,function(a){!b.isFull&&-1!==b.activityOfferingIds.indexOf(a.activityOfferingId)&&a.seatsOpen<=0&&(b.isFull=!0)})}),b.isWaitlistFull=angular.isNumber(b.maxWaitListSize)&&b.waitListSize>=b.maxWaitListSize,b.isWaitlistAvailable=b.waitListOffered&&!b.isWaitlistFull,b)}function p(){if(a.selectedAOs.length===a.course.activityOfferingTypes.length){var b=r();if(1===b.length)return o(b[0])}return null}function q(b){"object"==typeof b&&angular.isDefined(b.activityOfferingType)&&(b=b.activityOfferingType);var c=null;return angular.forEach(a.selectedAOs,function(a){null===c&&a.activityOfferingType===b&&(c=a)}),c}function r(){var b=a.availableRegGroups;return angular.forEach(a.selectedAOs,function(c){if(null===b){b=[];for(var d in c.regGroupInfos)b.push(a.availableRegGroups[d])}else{var e=[];angular.forEach(b,function(a){angular.isDefined(c.regGroupInfos[a.regGroupId])&&e.push(a)}),b=e}}),b||[]}function s(b){var c=!0;if(!t(b)&&a.hasSelectedAOs()){c=!1;for(var d=r(),e=0;e<d.length;e++)if(angular.isDefined(b.regGroupInfos[d[e].regGroupId])){c=!0;break}}return c}function t(b){return-1!==a.selectedAOs.indexOf(b)}function u(b){a.selectedAOs.splice(a.selectedAOs.indexOf(b),1),b.flags.selected=!1}function v(b,c){var d=q(b.activityOfferingType);null!==d&&u(d),a.selectedAOs.push(b),c||(b.flags.selected=!0)}console.log(">> SearchDetailsCtrl"),a.stateParams=c.params,a.course=null,a.$on("termIdChanged",function(b,d,e){null!==e&&"root.search.details"===a.uiState&&c.go("root.search.results",c.params)}),a.$on("$stateChangeSuccess",function(b,c,d){a.stateParams=d,angular.isDefined(d.id)&&(a.fromSchedule=d.searchCriteria===g.fromSchedule,k(d.id,d.code))}),a.loading=!1;var w=null;a.availableRegGroups={},a.aoMap={},a.selectedAOs=[],a.selectedRegGroup=null,a.singleRegGroup=!1,a.additionalInfo=!1,a.singleRegFormatted=[],a.clearSelectedAOs=function(){a.selectedRegGroup=null,a.selectedAOs=[],a.updateAOStates()},a.hasSelectedAOs=function(){return a.selectedAOs.length>0},a.isAOTypeSelected=function(a){var b=q(a);return null!==b},a.isSelectedRegGroupInCart=function(){return a.selectedRegGroup&&i.isCourseInCart(a.selectedRegGroup.regGroupId)},a.isSelectedRegGroupInWaitlist=function(){return a.selectedRegGroup&&j.isCourseWaitlisted(a.selectedRegGroup.regGroupId)},a.addToCart=function(){a.selectedRegGroup&&l("cart","addCourseToCart")},a.directRegister=function(){a.selectedRegGroup&&l("register","directRegisterForCourse")},a.addToWaitlist=function(){a.selectedRegGroup&&a.selectedRegGroup.isWaitlistAvailable&&(a.course.allowWaitlist=!0,l("waitlist","directRegisterForCourse"))},a.removeActionMessage=function(){a.actionType=null,a.actionStatus=!1},a.$on("showSubterm",function(b,c){var d=a.aoMap[c].subterm;e.open({templateUrl:"partials/additionalInfo.html",controller:"AdditionalInfoCtrl",size:"sm",resolve:{subterm:function(){return d},requisites:void 0}})}),a.$on("showRequisites",function(b,c){var d=a.aoMap[c].requisites;e.open({templateUrl:"partials/additionalInfo.html",controller:"AdditionalInfoCtrl",size:"sm",resolve:{requisites:function(){return d},subterm:void 0}})}),a.$on("toggleAO",function(b,c){var d=a.aoMap[c.aoId],e=!1;if(t(d))u(d);else{if(!s(d))return;v(d),e=!0}a.updateAOStates(),e&&n(),a.selectedRegGroup=p()
}),a.countEligibleAOs=function(a){var b=0;return angular.forEach(a,function(a){a.flags.disabled||a.flags.selected||b++}),b},a.updateAOStates=function(){angular.forEach(a.course.activityOfferingTypes,function(b){b.showAll&&a.isAOTypeSelected(b)&&(b.showAll=!1),angular.forEach(b.activityOfferings,function(c){c.flags.selected=t(c),c.flags.disabled=!s(c),c.flags.hidden=b.showAll||c.flags.selected?!1:a.isAOTypeSelected(b)?!0:c.flags.disabled})})},a.$watch("availableRegGroups",function(){if(angular.isDefined(a.availableRegGroups)&&angular.isDefined(a.stateParams.regGroupId)&&(angular.isUndefined(a.selectedRegGroup)||null===a.selectedRegGroup)){var b=a.stateParams.regGroupId,c=r();angular.forEach(c,function(c){if(b===c.regGroupId){a.selectedRegGroup=c;for(var d=0;d<c.activityOfferingIds.length;d++)angular.forEach(a.aoMap,function(b){b.activityOfferingId===c.activityOfferingIds[d]&&(v(b),a.updateAOStates())})}})}})}]).controller("AdditionalInfoCtrl",["$scope","subterm","requisites",function(a,b,c){function d(a){var b=new Date(a);return b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()}a.subterm=b,a.requisites=c,a.startDate=function(){return d(b.startDate)},a.endDate=function(){return d(b.endDate)}}]),angular.module("regCartApp").factory("DetailsFactory",["$injector",function(a){var b={},c=function(c){var d=b[c];return angular.isUndefined(d)&&(d=a.get(c)),angular.isUndefined(d)?console.log("Search Details configuration "+c+" is not defined"):b[c]=d,d};return c}]),angular.module("regCartApp").filter("creditRangeFormatter",function(){return function(a){var b="";if(a&&angular.isArray(a)){if(1===a.length)b=parseFloat(a[0]);else{var c=parseFloat(Math.min.apply(null,a)),d=parseFloat(Math.max.apply(null,a));b=c+"-"+d}b+=" cr"}return b}}).filter("aoFormatter",["DAY_CONSTANTS","RegUtil",function(a,b){function c(a){return null===a?"":a}function d(a,b){for(a=""+a;a.length<b;)a="0"+a;return a}function e(a,b){return a='<span class="kscr-Search-result-sort">'+b+"</span>"+a}function f(b){for(var c=[],d=0;d<a.dayArray.length;d++)b.indexOf(a.dayArray[d])>-1&&c.push(d);return c.sort().toString()}function g(a){var c=b.convertTimeStringToTime(a);return isNaN(c)&&(c=9999),d(c,4)}return function(a){for(var b=[],h=0;h<a.length;h++){var i=a[h],j=i.scheduleComponents,k=i.instructors,l="",m="",n="",o="",p="",q=void 0,r=!1;if(j&&angular.isArray(j)&&j.length>0){for(var s=0;s<j.length;s++)l+=c(j[s].days),m+=c(j[s].displayTime),n+=c(j[s].buildingCode)+" "+c(j[s].roomCode),s<j.length-1&&(l+="<br />",m+="<br />",n+="<br />");l=e(l,f(j[0].days)),m=e(m,g(j[0].startTime))}if(k&&angular.isArray(k)&&k.length>0){for(var t=0;t<k.length;t++)o+=c(k[t].firstName)+" "+c(k[t].lastName),t<k.length-1&&(o+="<br />");o=e(o,k[0].lastName+k[0].firstName)}p+=i.seatsOpen+"/"+i.seatsAvailable,0===i.seatsOpen&&(p='<span class="kscr-Search-results-no-seats">'+p+"</span>",r=!0),p=e(p,d(i.seatsOpen,3)+d(i.seatsAvailable,3));var u=!1,v=!1,w=i.honors;null!==i.subterm&&(u=!0),angular.isArray(i.requisites)&&i.requisites.length>0&&(v=!0),(u||v||w)&&(q=""),u&&(q+='<span class="kscr-SearchDetails-icon--subterm" title="Sub Term Offering" ng-click="$emit(\'showSubterm\', searchResult.aoId); $event.stopPropagation();"></span>'),v&&(q+='<span class="kscr-SearchDetails-icon--requisites" title="Requisites" ng-click="$emit(\'showRequisites\', searchResult.aoId); $event.stopPropagation();"></span>'),w&&(q+='<span class="kscr-SearchDetails-icon--honors" title="Honors Course" />');var x=i.activityOfferingCode,y={activity:i.activityOfferingTypeName,days:l,time:m,instructor:o,location:n,seatsOpen:p,additionalInfo:q,aoId:x,indicator:r};b.push(y)}return b}}]),angular.module("regCartApp").filter("cleanse",function(){return function(a){var b;return b=angular.isString(a)?a.replace(/ /g,""):a}}).filter("ordinal",function(){return function(a){if(!angular.isNumber(a))return a;var b=a%100,c=["th","st","nd","rd","th"],d=21>b?4>b?c[b]:c[0]:b%10>4?c[0]:c[b%10];return a+d}}).filter("multiplicativeAdverb",function(){return function(a,b){if(!angular.isNumber(a))return a;var c=a;switch(a){case 1:c="once";break;case 2:c="twice";break;default:b&&(c=a+b)}return c}}),angular.module("regCartApp").service("CartService",["$q","URLS","ServiceUtilities",function(a,b,c){var d=0,e=0,f=[],g={};this.getCart=function(b){var c=a.defer();return angular.isDefined(g[b])?c.resolve(g[b]):this.getCartFromServer().query({termId:b},function(a){g[b]=a,c.resolve(a)},function(a){c.reject(a)}),c.promise},this.getCartCredits=function(){return d},this.setCartCredits=function(a){d=a},this.getCartCourseCount=function(){return e},this.setCartCourseCount=function(a){e=a},this.getCartCourses=function(){return f},this.setCartCourses=function(a){f.splice(0,f.length),a&&(angular.forEach(a,function(a){f.push(a)}),this.setCartCourseCount(a.length))},this.isCourseInCart=function(a){return c.isCourseInList(a,this.getCartCourses())},this.getCartFromServer=function(){return c.getData(b.courseRegistrationCart+"/searchForCart")},this.addCourseToCart=function(){return c.postData(b.courseRegistrationCart+"/addCourseToCart")},this.removeItemFromCart=function(a){return c.deleteData(a)},this.invokeActionLink=function(a){return c.getData(a)},this.updateCartItem=function(){return c.putData(b.courseRegistrationCart+"/updateCartItem")},this.submitCart=function(){return c.getData(b.courseRegistrationCart+"/submitCart")},this.undoDeleteCourse=function(){return c.getData(b.courseRegistrationCart+"/undoDeleteCourse")}}]),angular.module("regCartApp").service("GlobalVarsService",["STATE","STATUS",function(a,b){var c,d={},e={},f=1;this.getUserId=function(){return c},this.setUserId=function(a){c=a},this.getConflictMap=function(){return d},this.setConflictMap=function(a){angular.equals(a,d)||(d=a)},this.getCorrespondingStatusFromState=function(c){var d=b.new;return a.processing.indexOf(c)>=0?d=b.processing:a.success.indexOf(c)>=0?d=b.success:a.error.indexOf(c)>=0?d=b.error:a.waitlist.indexOf(c)>=0?d=b.waitlist:a.action.indexOf(c)>=0&&(d=b.action),d},this.getCorrespondingMessageFromStatus=function(a){var c="";return a===b.waitlist&&(c="If a seat becomes available you will be registered automatically"),c},this.getCourseIndex=function(a){var b=a.courseCode+(a.regGroup||a.regGroupCode),c=e[b];return isNaN(c)&&(c=f++,e[b]=c),c},this.updateConflicts=function(a,b){for(var c=this.getConflictMap(),d=0;d<a.length;d++){var e=a[d],f=c[e.regGroupId];if(!angular.equals(e.conflicts,f))switch(b){case"REG":"REG"===f.type&&(e.conflicts=f);break;case"WAIT":("REG"===f.type||"WAIT"===f.type)&&(e.conflicts=f);break;default:e.conflicts=f}}}}]),angular.module("regCartApp").factory("loginInterceptor",["$q","$injector","$window","$rootScope",function(a,b,c,d){return{response:function(b){var c=b.data;return"object"!=typeof c&&c.indexOf("Kuali Student Login")>-1?(console.log("Informing user that session has expired..."),d.$broadcast("sessionExpired"),a.reject(b)):b},responseError:function(d){if(0===d.status){console.log("Failed to execute request - trying to login");var e=b.get("LoginService");e.logOnAsAdmin().query({userId:"student1",password:"student1"},function(){console.log("Logged in, reloading page."),c.location.reload()},function(){console.log("Not Logged in, reloading page."),c.location.reload()})}return a.reject(d)}}}]),angular.module("regCartApp").service("LoginService",["URLS","ServiceUtilities",function(a,b){this.logOnAsAdmin=function(){return b.getData(a.developmentLogin+"/login")},this.logout=function(){return b.getData(a.developmentLogin+"/logout")}}]),angular.module("regCartApp").service("MessageService",["$q","$resource",function(a,b){var c=null;this.getMessages=function(){var b=a.defer();return null!==c?b.resolve(c):this.loadMessages().query({},function(a){c=a,b.resolve(c)},function(a){b.reject(a)}),b.promise},this.getMessage=function(a){for(var b="",d=0;d<c.length;d++)if(c[d].messageKey===a){b=c[d].message;break}return b},this.loadMessages=function(){return b("json/messages.json",{},{query:{method:"GET",cache:!1,isArray:!0}})}}]),angular.module("regCartApp").service("RegUtil",[function(){this.convertTimeStringToTime=function(a){var b=a.indexOf(":"),c=a.substring(0,b),d=a.substring(b+1,a.indexOf(" ")),e=-1!==a.toLowerCase().indexOf("pm"),f=60*parseInt(c);return f+=parseInt(d),e&&"12"!==c&&(f+=720),f},this.convertStringToDate=function(a){var b,c=a.split("/");return 3===c.length?b=new Date(c[2],c[0]-1,c[1]):console.log("Invalid date string: "+a),b},this.standardizeCartCourse=function(a){a.longName=a.courseTitle,a.gradingOptionId=a.grading;var b=[];if(angular.isArray(a.schedule)){for(var c=0;c<a.schedule.length;c++){var d=a.schedule[c];d.scheduleComponents=[];for(var e=0;e<d.activityOfferingLocationTime.length;e++){var f={},g=d.activityOfferingLocationTime[e];f.buildingCode=g.location.building,f.roomCode=g.location.room,angular.extend(f,g.time),f.isTBA=g.isTBA,d.scheduleComponents.push(f)}delete d.activityOfferingLocationTime,b.push(d)}delete a.schedule}return a.activityOfferings=b,a}}]),angular.module("regCartApp").service("ScheduleService",["$q","$timeout","URLS","STATUS","ServiceUtilities","GlobalVarsService","COURSE_TYPES",function(a,b,c,d,e,f,g){var h,i,j=0,k=0,l=0,m=[],n=[],o={};this.getSchedule=function(b,c){var d=a.defer();return c||(c=!1),angular.isDefined(o[b])&&!c?d.resolve(o[b]):this.getScheduleFromServer().query({termId:b},function(a){o[b]=a,d.resolve(a)},function(a){d.reject(a)}),d.promise},this.getRegisteredCredits=function(){return h},this.setRegisteredCredits=function(a){h=a},this.getRegisteredCourseCount=function(){return j},this.setRegisteredCourseCount=function(a){j=a},this.getWaitlistedCredits=function(){return k},this.setWaitlistedCredits=function(a){k=a},this.getWaitlistedCourseCount=function(){return l},this.setWaitlistedCourseCount=function(a){l=a},this.getRegisteredCourses=function(){return m},this.getWaitlistedCourses=function(){return n},this.getScheduledCourses=function(){return m.concat(n)},this.removeRegisteredCourse=function(a){this.setRegisteredCredits(parseFloat(this.getRegisteredCredits())-parseFloat(a.credits)),this.setRegisteredCourseCount(parseInt(this.getRegisteredCourseCount())-1)},this.removeWaitlistedCourse=function(a){this.setWaitlistedCredits(parseFloat(this.getWaitlistedCredits())-parseFloat(a.credits)),this.setWaitlistedCourseCount(this.getWaitlistedCourses().length)},this.spliceCourse=function(a,b){switch(a){case g.waitlisted:this.getWaitlistedCourses().splice(this.getWaitlistedCourses().indexOf(b),1);break;case g.registered:this.getRegisteredCourses().splice(this.getRegisteredCourses().indexOf(b),1)}},this.updateRegisteredCourse=function(a,b){var c=parseFloat(this.getRegisteredCredits())-parseFloat(a.credits)+parseFloat(b.credits);console.log("registeredCredits = "+c),this.setRegisteredCredits(c)},this.updateWaitlistedCourse=function(a,b){var c=parseFloat(this.getWaitlistedCredits())-parseFloat(a.credits)+parseFloat(b.credits);console.log("waitlistedCredits = "+c),this.setWaitlistedCredits(c)},this.isCourseRegistered=function(a){return e.isCourseInList(a,this.getRegisteredCourses())},this.isCourseWaitlisted=function(a){return e.isCourseInList(a,this.getWaitlistedCourses())},this.getSchedules=function(){return i},this.setSchedules=function(a){i=a},this.updateScheduleCounts=function(a){var b=[];if(null!==a.registeredCourseOfferings&&null!==a.waitlistCourseOfferings){var c=a.registeredCourseOfferings,d=a.waitlistCourseOfferings;b=c.concat(d)}else null===a.registeredCourseOfferings&&null!==a.waitlistCourseOfferings?b=a.waitlistCourseOfferings:null!==a.registeredCourseOfferings&&null===a.waitlistCourseOfferings&&(b=a.registeredCourseOfferings);var e=a.userId,g=0,h=0;m.splice(0,m.length),n.splice(0,n.length),this.setSchedules(b),angular.forEach(a.registeredCourseOfferings,function(a){g+=parseFloat(a.credits),m.push(a);var b=0;angular.forEach(a.gradingOptions,function(){b++}),a.gradingOptionCount=b}),angular.forEach(a.waitlistCourseOfferings,function(a){h+=parseFloat(a.credits),n.push(a);var b=0;angular.forEach(a.gradingOptions,function(){b++}),a.gradingOptionCount=b}),m.sort(function(a,b){return a.createTime<b.createTime}),n.sort(function(a,b){return a.createTime<b.createTime}),this.setRegisteredCourseCount(m.length),this.setRegisteredCredits(g),this.setWaitlistedCredits(h),this.setWaitlistedCourseCount(n.length),f.setUserId(e)},this.pollRegistrationRequestStatus=function(c,e,g){angular.isNumber(e)||(e=1e3),g||(g=a.defer());var h=this;return b(function(){h.getRegistrationStatus().query({regReqId:c},function(a){var b=f.getCorrespondingStatusFromState(a.state);switch(b){case d.new:case d.processing:var i=!1;angular.forEach(a.responseItemResults,function(a){if(!i){var b=f.getCorrespondingStatusFromState(a.state);switch(b){case d.new:case d.processing:i=!0}}}),g.notify(a),i?h.pollRegistrationRequestStatus(c,e,g):g.resolve(a);break;case d.success:g.notify(a),g.resolve(a);break;case d.error:g.reject(a)}},function(a){g.reject(a)})},e),g.promise},this.getScheduleFromServer=function(){return e.getData(c.courseRegistration+"/studentSchedule")},this.dropRegistrationGroup=function(){return e.deleteData(c.courseRegistration+"/registrationRequest")},this.registerForRegistrationGroup=function(){return e.postData(c.courseRegistration+"/registrationRequest")},this.updateScheduleItem=function(){return e.putData(c.courseRegistration+"/registrationRequest")},this.dropFromWaitlist=function(){return e.deleteData(c.courseRegistration+"/waitlistRegistrationRequest")},this.updateWaitlistItem=function(){return e.putData(c.courseRegistration+"/waitlistRegistrationRequest")},this.getRegistrationStatus=function(){return e.getData(c.courseRegistration+"/registrationStatus")}}]),angular.module("regCartApp").service("SearchService",["URLS","ServiceUtilities",function(a,b){var c=30,d=[];this.searchForCourses=function(){var a=this;return{query:function(b,e,f){var g=Math.round(+new Date/1e3),h=null,i=[];angular.forEach(d,function(a){angular.isDefined(a.timestamp)&&g-a.timestamp<c&&(i.push(a),a.criteria===b.criteria&&a.termId===b.termId&&(h=a))}),d=i,null===h?(h=angular.copy(b),h.timestamp=g,a.searchForCoursesFromServer().query(b,function(a){h.results=a,d.push(h),e(a)},f)):(console.log("- Returning Cached Results (valid for "+(c-(g-h.timestamp))+"s) "),e(h.results))}}},this.searchForCoursesFromServer=function(){return b.getArray(a.scheduleOfClasses+"/search")},this.getCourse=function(){return b.getData(a.scheduleOfClasses+"/courseOfferingDetails")}}]),angular.module("regCartApp").service("ServiceUtilities",["$resource","APP_URL",function(a,b){function c(a){var b=[];for(var c in a)a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}this.getData=function(c){return a(b+c,{},{query:{method:"GET",cache:!1,isArray:!1}})},this.deleteData=function(c){return a(b+c,{},{query:{method:"DELETE",cache:!1,isArray:!1}})},this.postData=function(d){return a(b+d,{},{query:{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",cache:!1,isArray:!1,transformRequest:function(a){return c(a)}}})},this.putData=function(d){return a(b+d,{},{query:{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"PUT",cache:!1,isArray:!1,transformRequest:function(a){return c(a)}}})},this.getArray=function(c){return a(b+c,{},{query:{method:"GET",cache:!1,isArray:!0}})},this.isCourseInList=function(a,b){angular.isString(a)&&(a={regGroupId:a});var c=!1;return angular.forEach(b,function(b){c||b.regGroupId!==a.regGroupId||(c=!0)}),c}}]),angular.module("regCartApp").service("TermsService",["$q","ServiceUtilities","URLS","DEFAULT_TERM",function(a,b,c,d){var e=null;this.getSelectedTerm=function(){return e},this.setSelectedTerm=function(a){e=a},this.getTermId=function(){var a=this.getSelectedTerm();return null!==a?a.termId:null},this.getTermByCode=function(a){var b=null;return angular.isArray(f)&&angular.forEach(f,function(c){c.termCode===a&&(b=c)}),b},this.getTermById=function(a){var b=null;return angular.isArray(f)&&angular.forEach(f,function(c){c.termId===a&&(b=c)}),b};var f=null;this.getTerms=function(){var b=a.defer();return null!==f?b.resolve(f):this.getTermsFromServer().query({termCode:null,active:!0},function(a){f=a,b.resolve(a)},function(a){b.reject(a)}),b.promise};var g={};this.isStudentEligibleForTerm=function(b){var c=a.defer();return b.termId!==d&&(console.log("-- Term eligibility check bypassed - term != default term"),g[b.termId]=!0),angular.isDefined(g[b.termId])?c.resolve(g[b.termId]):this.checkStudentEligibilityForTerm().query({termId:b.termId},function(a){var d=angular.isDefined(a.isEligible)&&a.isEligible||!1;g[b.termId]=d,c.resolve(d,a)},function(a){c.reject(a)}),c.promise},this.checkStudentEligibilityForTerm=function(){return b.getData(c.scheduleOfClasses+"/checkStudentEligibilityForTerm")},this.getTermsFromServer=function(){return b.getArray(c.scheduleOfClasses+"/terms")}}]),angular.module("regCartApp").service("CourseCalendarDataParser",["GRID_CONSTANTS","DAY_CONSTANTS","RegUtil","GlobalVarsService",function(a,b,c,d){function e(){var a={};return a[b.monday]=[],a[b.tuesday]=[],a[b.wednesday]=[],a[b.thursday]=[],a[b.friday]=[],a}function f(a,b,c){return angular.forEach(b,function(b){if(!b.dropped){var d={courseCode:b.courseCode,regGroup:b.regGroupCode};angular.forEach(b.activityOfferings,function(e){angular.forEach(e.scheduleComponents,function(e){a=g(a,d,e,c,b)})})}}),a}function g(a,c,d,e,f){return d.isTBA||angular.forEach(b.dayArray,function(b){d.days.indexOf(b)>-1&&(a=h(a,c,d,b,e,f))}),a}function h(a,d,e,f,g,h){if(!e.startTime||!e.endTime)return a;angular.isArray(a[f])||(a[f]=[],f!==b.saturday||angular.isArray(a[b.sunday])||(a[b.sunday]=[]),f!==b.sunday||angular.isArray(a[b.saturday])||(a[b.saturday]=[]));var i=c.convertTimeStringToTime(e.startTime),j=c.convertTimeStringToTime(e.endTime);i>j&&(j+=1440);var k={index:m(d),courseCode:o(d.courseCode),startTime:i,endTime:j,type:g,key:d.courseCode+"."+f+"."+i+"."+j,details:h};return a[f].push(k),a}function i(c){var d=["REG","WAIT","CART"],e=[],f=a.defaultStart,g=a.defaultEnd,h=a.defaultBuffer;return angular.forEach(b.dayArray,function(a){var b=c[a];if(angular.isArray(b)){var i={};angular.forEach(b,function(a){var b=a.type;angular.isArray(i[b])||(i[b]=[]),i[b].push(a),(null===f||a.startTime-h<f)&&(f=a.startTime-h),(null===g||a.endTime+h>g)&&(g=a.endTime+h)});var k=[];angular.forEach(d,function(a){angular.forEach(i[a],function(a){k.push(a)})}),j(k),l(k),e.push({day:a,courses:k})}}),0>f&&(f=0),{timeRange:[f,g],days:e}}function j(a){var b=[[]],c={};return angular.forEach(a,function(a){a.conflicts=[],a.lane=0;var d=!1;if(angular.forEach(b,function(e){var f=!1;angular.forEach(e,function(b){k(a,b)&&(n(a,b),n(b,a),f=!0,a.conflicts.push(b.key),b.conflicts.push(a.key))}),f||d||(a.lane=b.indexOf(e),c[a.key]=a.lane,e.push(a),l(e),d=!0)}),!d){var e=b.push([a]);a.lane=e-1,c[a.key]=a.lane}}),angular.forEach(a,function(a){var b=0;switch(angular.forEach(a.conflicts,function(a){c[a]>b&&(b=c[a])}),a.conflictCount=Math.max(b,a.lane),a.conflictCount){case 0:a.truncated=a.courseCode;break;case 1:a.truncated=a.courseCode.substring(0,1)+"...";break;default:a.courseCode.substring(0,1)}}),a}function k(a,b){return a.startTime<=b.endTime&&a.endTime>=b.startTime}function l(a){return a.sort(function(a,b){return a.startTime===b.startTime?0:a.startTime<b.startTime?-1:1}),a}function m(a){return d.getCourseIndex(a)}function n(a,b){var c=a.details.regGroupId,d={courseCode:b.details.courseCode,regGroupCode:b.details.regGroupCode,type:b.type};angular.isArray(p[c])||(p[c]=[]);for(var e=!1,f=0;f<p[c].length;f++)if(angular.equals(p[c][f],d)){e=!0;break}e||p[c].push(d)}function o(a){var b=a.match(/^[a-zA-Z]+/),c=a.replace(b,"");return b+"&#8203;"+c}var p;this.buildCalendar=function(a,b,c){p={};var g=e();a&&(g=f(g,a,"REG")),b&&(g=f(g,b,"WAIT")),c&&(g=f(g,c,"CART"));var h=i(g);return d.setConflictMap(p),d.updateConflicts(a,"REG"),d.updateConflicts(b,"WAIT"),h}}]),angular.module("regCartApp").directive("courseCalendar",["$timeout","$window",function(a,b){return{restrict:"E",scope:{size:"@"},templateUrl:"partials/courseCalendar.html",controller:["$scope","CourseCalendarDataParser","CartService","ScheduleService",function(a,b,c,d){a.courseFilter=function(b){var c=!0;switch(b.type){case"REG":c=!a.hideRegistered;break;case"WAIT":c=!a.hideWaitlisted;break;case"CART":c=!a.hideCart}return c},a.timeFilter=function(b){var c=b.getHours();return a.visibleTimeRange[0]/60<=c&&c<=a.visibleTimeRange[1]/60},a.selectedCourse=null,a.$on("course-clicked",function(b,c){a.selectedCourse=a.selectedCourse&&a.selectedCourse.index===c.index?null:c,a.$apply()}),a.clearSelectedCourse=function(){a.selectedCourse=null};var e=a.size;"small"!==e&&(e="large"),a.calendarSize=e,a.orientation="",a.hideRegistered=!1,a.hideWaitlisted=!1,a.hideCart=!1;var f=function(){null!==a.selectedCourse&&(a.selectedCourse=null)};a.$watch("hideRegistered",f),a.$watch("hideWaitlisted",f),a.$watch("hideCart",f),a.visibleTimeRange=[],a.times=[];for(var g=0;24>g;g++)a.times.push(new Date(0,0,0,g,0,0,0));a.registered=d.getRegisteredCourses(),a.waitlisted=d.getWaitlistedCourses(),a.cart=c.getCartCourses();var h=function(c){if(c){var d=b.buildCalendar(a.registered,a.waitlisted,a.cart);a.visibleTimeRange=[60*Math.floor(d.timeRange[0]/60),60*Math.ceil(d.timeRange[1]/60)],a.days=d.days}};h(!0),a.$watchCollection("registered",h),a.$watchCollection("waitlisted",h),a.$watchCollection("cart",h)}],link:function(c,d){function e(){return d.find(".kscr-CourseCalendar-orientation--horizontal:visible").length>0?"horizontal":"vertical"}a(function(){c.orientation=e()}),"large"===c.calendarSize&&angular.element(b).on("resize",function(){a(function(){var a=e();a!==c.orientation&&(c.orientation=a,c.$broadcast("orientationChanged",c.orientation))})})}}}]),angular.module("regCartApp").directive("courseCalendarLane",["$timeout",function(a){return{restrict:"CAE",link:function(b,c,d){b.scrollAfter=d.scrollAfter||null,b.updateLaneHeight=function(){var a=c.children();if(a.length>0){var d=0;angular.forEach(b.day.courses,function(a){d<a.lane+1&&(d=a.lane+1)});var e=c.children()[0].offsetHeight,f=e*d;e>0&&f>0&&c.height(f)}},a(b.updateLaneHeight),b.$on("orientationChanged",function(){a(b.updateLaneHeight)}),b.$on("updateLaneHeight",function(){a(b.updateLaneHeight)})}}}]),angular.module("regCartApp").directive("courseCalendarItem",["$timeout",function(a){return{restrict:"CAE",link:function(b,c){function d(){var a=b.visibleTimeRange,d=a[1]-a[0],f=b.course.endTime-b.course.startTime,g=100*f/d,h=100*(b.course.startTime-a[0])/d;b.course.layout={position:h,proportion:g},c.css({left:h+"%",top:h+"%",height:g+"%",width:g+"%"}),e(),b.$emit("updateLaneHeight")}function e(){if(angular.isUndefined(b.course.layout))return void d();var a={left:b.course.layout.position+"%",top:b.course.layout.position+"%",height:b.course.layout.proportion+"%",width:b.course.layout.proportion+"%"};if(b.course.conflictCount>0)if("horizontal"===b.orientation)a.top=b.course.lane*c[0].offsetHeight+"px";else{var e=100;b.course.conflictCount>0&&(e=100/(b.course.conflictCount+1)),a.left=e*b.course.lane+"%",a.width=e+"%"}c.css(a)}a(d),b.$on("orientationChanged",function(){a(e)}),c.bind("click",function(){b.$emit("course-clicked",b.course)})}}}]),angular.module("regCartApp").directive("courseCard",function(){return{transclude:!0,scope:{schedules:"=",credits:"=",type:"@"},templateUrl:"partials/courseCard.html",controller:"CardCtrl"}}).directive("courseAccordion",function(){return{restrict:"E",transclude:!0,scope:{course:"=",type:"@",cardIndex:"=",cartId:"="},templateUrl:"partials/courseAccordion.html",controller:"CardCtrl"}}).controller("CardCtrl",["$scope","$state","$timeout","STATUS","GRADING_OPTION","COURSE_TYPES","SEARCH_CRITERIA","GlobalVarsService","ScheduleService",function(a,b,c,d,e,f,g,h,i){function j(){var b;switch(a.type){case f.waitlisted:b={heading:"Waitlisted",prefix:"waitlisted",prefix2:"waitlist_",prefix3:"waitlist_",remove:"Remove"};break;case f.cart:b={heading:"Cart",prefix:"cart",prefix2:"",prefix3:"cart_",remove:"Remove"};break;default:b={heading:"Registered",prefix:"reg",prefix2:"",prefix3:"schedule_",remove:"Drop"}}return b}function k(a){return a.credits=a.newCredits,a.gradingOptionId=a.newGrading,a}function l(a,b,c,d){angular.isArray(c)||(c=[c]),b.statusMessage={action:a,type:d,messages:c}}function m(a){a.newCredits=a.credits,a.newGrading=a.gradingOptionId}function n(a){var b=angular.copy(a);k(a),a.editing=!1,a.isopen=!1,a.gradingOptionId!==b.gradingOptionId&&(a.editGradingOption=!0,c(function(){a.editGradingOption=!1},2e3)),a.credits!==b.credits&&(a.editCredits=!0,c(function(){a.editCredits=!1},2e3))}a.config=j(),a.courseTypes=f,a.statuses=d,a.registeredCourseOfferings=i.getRegisteredCourses(),a.waitlistCourseOfferings=i.getWaitlistedCourses(),a.cancelDropConfirmation=function(a){a.dropping=!1},a.showBadge=function(a){return a.gradingOptionId!==e.letter||a.editGradingOption},a.editItem=function(a){a.newCredits=a.credits,a.newGrading=a.gradingOptionId,a.editing=!0},a.gradingOption=function(b){return b.gradingOptions[a.course.gradingOptionId]},a.courseIndex=function(a){return angular.isDefined(a.index)&&a.index||(a.index=h.getCourseIndex(a)),a.index},a.removeStatusMessage=function(b){var c=b.statusMessage;b.statusMessage=null,a.$emit("courseStatusMessageRemoved",a.type,b,c)},a.dropCourse=function(b){switch(a.type){case f.cart:a.$emit("deleteCartItem",b);break;default:console.log("Open drop confirmation"),b.dropping=!0}},a.viewDetails=function(a){b.go("root.search.details",{searchCriteria:g.fromSchedule,id:a.courseId,code:a.courseCode,regGroupId:a.regGroupId})},a.dropCourseConfirmed=function(b){b.dropping=!1,b.dropProcessing=!0,l("drop",b,"<strong>"+b.courseCode+" ("+b.regGroupCode+")</strong> drop processing",d.processing),a.$emit("dropCourse",a.type,b,function(){b.dropped=!0,b.dropProcessing=!1;var c;switch(a.type){case f.registered:c="<strong>"+b.courseCode+" ("+b.regGroupCode+")</strong> dropped successfully";break;case f.waitlisted:c="Removed from waitlist for <strong>"+b.courseCode+" ("+b.regGroupCode+")</strong> successfully"}l("drop",b,c,d.success)},function(a){b.dropProcessing=!1,b.isopen=!1,l("drop",b,a,d.error)})},a.updateItem=function(b){console.log("Updating "+a.type+" course. Grading: "+b.newGrading+", Credits: "+b.newCredits),b.requestProcessing=!0;var c=angular.copy(b);k(c),a.$emit("updateCourse",a.type,b,c,function(){b.requestProcessing=!1,n(b)},function(a){b.requestProcessing=!1,b.editing=!1,b.isopen=!1,m(b),l("update",b,a,d.error)})},a.parseConflicts=function(a){var b="";if(angular.isArray(a)&&a.length>0)for(var c=0;c<a.length;c++)c>0&&(b+=", "),b+=a[c].courseCode;return b}}]),angular.module("regCartApp").directive("courseOptions",["GRADING_OPTION",function(a){return{restrict:"E",transclude:!0,scope:{course:"=",maxOptions:"@max",prefix:"@",showAll:"@",moreButtonSelectBehavior:"@moreBehavior",cancelText:"@",submitText:"@",cancelFn:"&onCancel",submitFn:"&onSubmit"},templateUrl:"partials/courseOptions.html",controller:["$scope","$modal",function(b,c){function d(a,b,c){if(a.length<=h)return!0;var d=a.indexOf(b),e=a.indexOf(c),f=2,g=Math.max(0,Math.min(d-f,a.length-h)),i=Math.min(g+h,a.length)-1;return e>=g&&i>=e}function e(){var a=b.$new();a.course=angular.copy(g),a.cancel=function(){},a.submit=function(){},g.editing=!1;var d=c.open({backdrop:"static",template:'<div class="kscr-AdditionalOptions"><course-options course="course" show-all="true" max="'+h+'" prefix="modal_'+(b.prefix?b.prefix:"")+'" on-submit="modalSubmit()" on-cancel="modalCancel()"></course-options></div>',scope:a,controller:["$scope",function(a){a.showAllCreditOptions=!0,a.showAllGradingOptions=!0,a.modalCancel=function(){a.$dismiss("cancel")},a.modalSubmit=function(){a.$close(a.course)}}]});d.result.then(function(a){g.newGrading=a.newGrading,g.newCredits=a.newCredits,b.submit()},function(){b.cancel()})}function f(){b.showAllCreditOptions=i,b.showAllGradingOptions=i}var g=b.course,h=b.maxOptions||4,i=b.showAll?!0:!1,j=b.moreButtonSelectBehavior||"expand";b.showAllCreditOptions=i,b.showAllGradingOptions=i,b.gradingOptions=[],g&&g.gradingOptions&&angular.forEach(g.gradingOptions,function(a,b){this.push({key:b,label:a})},b.gradingOptions),g.creditOptions.sort(function(a,b){var c=parseFloat(a),d=parseFloat(b);return c===d?0:c>d?1:-1}),g.newGrading=g.gradingOptionId?g.gradingOptionId:angular.isDefined(g.gradingOptions[a.letter])?a.letter:b.gradingOptions[0],g.newCredits=g.credits?g.credits:g.creditOptions[0],b.creditOptionsFilter=function(a){return!g||b.showAllCreditOptions?!0:d(g.creditOptions,g.credits,a)},b.gradingOptionsFilter=function(a){return!g||b.showAllGradingOptions?!0:d(Object.keys(g.gradingOptions),g.grading,a.key)},b.showMoreCreditOptions=function(){"expand"===j?b.showAllCreditOptions=!0:e()},b.showMoreGradingOptions=function(){"expand"===j?b.showAllGradingOptions=!0:e()},b.shouldShowMoreCreditOptionsToggle=function(){return!b.showAllCreditOptions&&g.creditOptions.length>h},b.shouldShowMoreGradingOptionsToggle=function(){return!b.showAllGradingOptions&&Object.keys(g.gradingOptions).length>h},b.cancel=function(){console.log("Canceling options changes"),g.newCredits=g.credits,g.newGrading=g.grading||g.gradingOptionId,g.status="",g.editing=!1,b.cancelFn&&b.cancelFn({course:g}),f()},b.submit=function(){console.log("Submitting options form"),b.submitFn&&b.submitFn({course:g}),f()},b.showGradingHelp=function(){c.open({templateUrl:"partials/gradingOptionsHelp.html"})}}]}}]),angular.module("regCartApp").directive("focusMe",["$timeout","$parse",function(a,b){return{link:function(c,d,e){var f=b(e.focusMe);c.$watch(f,function(b){b===!0&&a(function(){d[0].focus()})}),d.bind("blur",function(){a(function(){d[0].focus()})})}}}]).directive("focusOnce",["$timeout","$parse",function(a,b){return{link:function(c,d,e){var f=b(e.focusOnce);c.$watch(f,function(b){b===!0&&a(function(){d[0].focus()})})}}}]).directive("dropMenu",["$window",function(a){return{controller:["$scope",function(b){return angular.element(a).bind("resize",function(){b.dropMenu===!0&&(b.dropMenu=!1)})}],templateUrl:"dropMenu.html"}}]),angular.module("regCartApp").directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}]);var maskUtils={mask:function(a,b){return b?b.remove():b=angular.element('<div class="util-Mask"/>'),a.append(b),a.addClass("util-Mask--masked"),b},unmask:function(a,b){b&&(b.remove(),b=null,a.removeClass("util-Mask--masked"))},resetZIndex:function(a,b){a.css("zIndex",b)},updateZIndex:function(a,b){var c=b.css("zIndex"),d=a.css("zIndex");return a.css("zIndex",c+1),d}};angular.module("regCartApp").directive("maskScreen",["$timeout","$document",function(a,b){return{restrict:"A",scope:{maskScreen:"="},link:function(c,d){function e(){j=maskUtils.mask(i),j.bind("click",function(){f()}),h=maskUtils.updateZIndex(d,j),k=!0}function f(){maskUtils.unmask(i,j),maskUtils.resetZIndex(d,h),k=!1,a(function(){c.maskScreen=!1})}function g(a){a&&!k?e():!a&&k&&f()}var h,i=b.find("body"),j=null,k=!1;c.$watch("maskScreen",g),g(c.maskScreen),d.bind("$destroy",f)}}}]),angular.module("regCartApp").directive("maskWhen",["$timeout",function(a){return{restrict:"A",scope:{maskWhen:"="},link:function(b,c){function d(){g=maskUtils.mask(c),g.bind("click",function(){e()}),h=!0}function e(){maskUtils.unmask(c,g),h=!1,a(function(){b.maskWhen=!1})}function f(a){a&&!h?d():!a&&h&&e()}var g=null,h=!1;b.$watch("maskWhen",f),f(b.maskWhen),c.bind("$destroy",e)}}}]),angular.module("regCartApp").directive("searchDetailsList",["$timeout","$animate","DetailsFactory",function(a,b,c){return{restrict:"E",templateUrl:"partials/searchDetailsList.html",scope:{searchDetails:"=",selectable:"=",config:"@"},link:function(d){var e=new c(d.config);d.sections=e.getSections(d.searchDetails),angular.isFunction(e.setDefaultField)&&e.setDefaultField(d.searchDetails),b.enabled(!1,angular.element(document.querySelector(".kscr-Search-details-grid")));
for(var f=0;f<d.sections.length;f++)d.sections[f].tabs=angular.copy(e.tabs),d.sections[f].tab=angular.copy(e.selectedTab);d.fieldOptions=e.fieldOptions,d.icons=e.icons,d.select=function(a,b){a.tab=b;for(var c=0;c<a.tabs.length;c++)a.tabs[c].selected=a.tabs[c].id===b||"all"===b},d.selectRow=function(a){d.selectable&&!angular.isUndefined(e.selectEvent)&&d.$emit(e.selectEvent,a)};var g=20;d.limit=g,d.$watch("limit",function(){d.limit<d.searchDetails.length&&a(function(){d.limit+=g},250)})}}}]),angular.module("regCartApp").directive("searchFacet",["SearchFacetService",function(a){return{restrict:"ECA",scope:{facet:"=",results:"="},templateUrl:"partials/searchFacet.html",controller:["$scope",function(b){function c(a,c){for(var d=0;d<a.length;d++)a[d].count=0;for(d=0;d<c.length;d++)for(var e=0;e<a.length;e++)b.facet.filter(c[d],a[e].value)&&a[e].count++;return a}function d(a){angular.isFunction(b.facet.prepare)&&b.facet.prepare(a);var d=b.facet.optionsProvider(a);return angular.isFunction(b.facet.refine)&&(d=b.facet.refine(d,a),d=c(d,a)),d}function e(a){b.options.length>0&&b.clearSelectedOptions();var c=d(a);b.options=c,angular.isDefined(b.facet.autoCollapse)&&!b.facet.autoCollapse||1!==c.length||(b.isCollapsed=!0)}function f(a){var c=-1;if(angular.isArray(a.value))for(var d=0;d<b.facet.selectedOptions.length;d++){for(var e=b.facet.selectedOptions[d],f=!0,g=0;g<a.value.length;g++)if(-1===e.indexOf(a.value[g])){f=!1;break}if(f){c=d;break}}else c=b.facet.selectedOptions.indexOf(a.value);return c}a.initFacet(b.facet),b.options=[],angular.isUndefined(b.facet.selectedOptions)&&(b.facet.selectedOptions=[]),b.$watch("results",function(a){e(a)}),b.$watchCollection("facet.selectedOptions",function(a,c){!angular.isArray(a)||angular.isArray(c)&&a.length===c.length&&0===a.length||b.$emit("facetSelectionChange",b.facet,a,c||[])}),b.clearSelectedOptions=function(){b.facet.selectedOptions=[]},b.hasSelected=function(){return b.facet.selectedOptions.length>0},b.isSelected=function(a){return-1!==f(a)},b.toggleOption=function(a){var c=f(a);-1===c?b.facet.selectedOptions.push(a.value):b.facet.selectedOptions.splice(c,1)}}]}}]).service("SearchFacetService",function(){this.initFacets=function(a){for(var b=0;b<a.length;b++)this.initFacet(a[b]);return a},this.initFacet=function(a){return angular.isFunction(a.optionsProvider)||(a.optionsProvider=function(b){var c=[];if(angular.isDefined(a.optionsKey)&&null!==a.optionsKey)for(var d=0;d<b.length;d++){var e=b[d];if(angular.isDefined(e[a.optionsKey])){var f=e[a.optionsKey];angular.isArray(f)||(f=[f]);for(var g=0;g<f.length;g++){for(var h=f[g],i=null,j=0;j<c.length;j++)if(c[j].value===h){i=c[j];break}null===i&&(i={label:h,value:h,count:0},c.push(i)),i.count++}}}else console.log('Facet "'+a.id+'" is missing the required optionsKey value');return c.sort(function(a,b){return a.label===b.label?0:a.label<b.label?-1:1}),c}),angular.isFunction(a.filter)||(a.filter=function(b,c){function d(a,b){var c=!1;if(angular.isArray(a)){for(var e=0;e<a.length;e++)if(d(a[e],b)){c=!0;break}}else if(angular.isArray(b)){for(var f=0;f<b.length;f++)if(d(a,b[f])){c=!0;break}}else c=a===b;return c}if(angular.isDefined(a.optionsKey)&&null!==a.optionsKey&&angular.isDefined(b[a.optionsKey])){var e=b[a.optionsKey];return d(e,c)}return!1}),a}}),angular.module("regCartApp").directive("searchForm",[function(){return{restrict:"ECA",templateUrl:"partials/searchForm.html",controller:["$scope","$state",function(a,b){function c(){var a=null;return angular.isDefined(b.params)&&angular.isDefined(b.params.searchCriteria)&&"fromschedule"!==b.params.searchCriteria&&(a=b.params.searchCriteria),a}function d(){var d=c();null!==d?d!==a.courseSearchCriteria&&(a.courseSearchCriteria=b.params.searchCriteria):a.courseSearchCriteria=""}a.courseSearchCriteria="",d(),a.$on("$stateChangeSuccess",function(){d()}),a.submit=function(){var c=angular.copy(b.params);angular.forEach(c,function(a,b){switch(b){case"term":case"searchCriteria":break;default:c[b]=null}}),c.searchCriteria=a.courseSearchCriteria,b.go("root.search.results",c)}}]}}]),angular.module("regCartApp").directive("searchList",["$filter","$animate","$timeout",function(a,b,c){return{restrict:"E",require:"^searchResults",templateUrl:"partials/searchList.html",scope:{searchResults:"=?",searchColumns:"=",searchData:"=?",displayMax:"@displayLimit",state:"=?",searchCriteria:"@",termName:"@",detailsId:"@",defaultField:"@",preprocessor:"@",onClick:"@",prefix:"@",showMobile:"@",last:"=?",noResults:"@"},link:function(d){function e(a,b){if(a!==b){var c={displayLimit:d.displayLimit,page:d.page,predicate:d.predicate||null,reverse:d.predicate?d.reverse:null};d.$emit("resultsStateChanged",c)}}b.enabled(!1,angular.element(document.querySelector(".kscr-Search-row"))),b.enabled(!1,angular.element(document.querySelector(".kscr-Search-result"))),angular.isUndefined(d.searchResults)&&d.preprocessor&&(d.searchResults=a(d.preprocessor)(d.searchData));var f=20;d.limit=0,d.mobileLimit=0,d.$watch("limit",function(){d.limit>0&&d.limit<d.displayLimit?c(function(){d.limit+=f},250):d.limit>d.displayLimit&&(d.limit=d.displayLimit)}),d.$watch("mobileLimit",function(){d.mobileLimit>0&&d.mobileLimit<d.searchResults.length?c(function(){d.mobileLimit+=f},250):d.mobileLimit>d.searchResults.length&&(d.mobileLimit=d.searchResults.length)}),d.displayLimits=[20,50,100],angular.isDefined(d.state)&&(d.displayLimit=parseInt(d.state.displayLimit),d.page=parseInt(d.state.page),d.predicate=d.state.predicate,d.reverse=d.state.reverse||void 0),d.page=d.page||1,-1===d.displayLimits.indexOf(d.displayLimit)&&(d.displayLimit=d.displayLimits[0]),angular.isDefined(d.displayMax)&&d.displayMax&&(d.displayLimit=d.displayMax),d.detailsId={},d.reverseMap={},d.lastPage=function(){return Math.ceil(d.searchResults.length/d.displayLimit)},d.pageRange=function(){for(var a=[],b=d.lastPage(),c=1;b>=c;c++)a.push(c);return a},d.$watch("displayLimit",function(){d.page=1,d.limit+=f}),d.$watch("searchResults",function(){0===d.lastPage()?d.page=d.state.page||1:d.page>d.lastPage()&&(d.page=1),d.mobileLimit+=f}),d.displayRangeMin=function(){return(d.page-1)*d.displayLimit+1},d.displayRangeMax=function(){var a=d.displayRangeMin(),b=a+d.displayLimit-1;return b>d.searchResults.length&&(b=d.searchResults.length),b},d.applyFilter=function(b,c,d){if(angular.isDefined(b._cachedValues)&&angular.isDefined(b._cachedValues[c]))return b._cachedValues[c];var e=null;if(c&&angular.isUndefined(b[c])&&-1!==c.indexOf(".")){for(var f,g=b,h=c.split("."),i=0;f=h[i],i<h.length;i++){if(!angular.isDefined(g[f])){g=null;break}g=g[f]}null!==g&&(e=g)}else e=b[c];return angular.isArray(e)&&d&&(e=a(d)(e)),angular.isUndefined(b._cachedValues)&&(b._cachedValues={}),b._cachedValues[c]=e,e},d.getId=function(a){return a[d.detailsId]},d.sortColumn=function(a){a.sortable&&(d.predicate=a.field,d.reverse=d.sortResults(a.field))},d.sortResults=function(a){var b;switch(angular.isUndefined(d.reverseMap[a])&&(d.reverseMap[a]=0),d.reverseMap[a]){case 0:d.reverseMap[a]=1,b=!1;break;case 1:d.reverseMap[a]=2,b=!0;break;case 2:d.reverseMap[a]=0,d.predicate=void 0}return b},d.emitEvent=function(a,b){a&&d.$emit(a,b)},d.hasData=function(a){for(var b=!1,c=0;c<d.searchResults.length;c++){var e=d.applyFilter(d.searchResults[c],a);if(e){b=!0;break}}return b},d.$watch("displayLimit",e),d.$watch("page",e),d.$watch("predicate",e),d.$watch("reverse",e),d.$on("clearSelected",function(){angular.forEach(d.searchResults,function(a){a.selected=!1,a.hidden=!1})}),d.$on("hideRow",function(a,b){angular.forEach(d.searchResults,function(a){a[d.defaultField]===b&&(a.hidden=!0)})}),d.$on("showRow",function(a,b){angular.forEach(d.searchResults,function(a){a[d.defaultField]===b&&(a.hidden=!1)})}),d.$on("showAllRows",function(){angular.forEach(d.searchResults,function(a){a.hidden&&(a.hidden=!1)})})}}}]).directive("searchResults",function(){return{restrict:"E",controller:"SearchResultsCtrl"}}).directive("searchColumn",function(){return{restrict:"E",require:"^searchResults",link:function(a,b,c){if(c.name||c.field||c.filter){angular.isArray(a.searchColumns)||(a.searchColumns=[]);var d={name:c.name,field:c.field,filter:c.filter,order:c.order,url:c.url,sortable:c.sortField,optional:c.optional,checkbox:c.checkbox};d.sortable="false"!==d.sortable,d.optional="true"===d.optional,a.searchColumns.push(d),a.sortSearchColumns()}}}}).controller("SearchResultsCtrl",["$scope","$filter",function(a,b){a.sortSearchColumns=function(){a.searchColumns=b("orderBy")(a.searchColumns,"order")}}]),angular.module("regCartApp").directive("sticky",["$timeout","$window","$document",function(a,b,c){return{restrict:"CA",link:function(d,e,f){a(function(){function d(){p||(n=e.offset().top);var c=l.height()<=e.height(),f=(b.pageYOffset||l.scrollTop())-(l.clientTop||0),j=c;if(!j)if("bottom"===m){var k=n+e.outerHeight(),o=b.innerHeight+f;n&&(i&&n||(i=k),j=i>o,j&&!p&&(i=k))}else i=n,j=f>=i;!p&&j?g():p&&!j&&h(),p&&c&&a(d,500)}function g(){o&&(j||(j=angular.element('<div class="util-sticky-placeholder"/>')),j.css("height",e.outerHeight()+"px"),j.insertBefore(e)),e.addClass("util-sticky--stuck"),p=!0}function h(){j&&(j.remove(),j=null),e.removeClass("util-sticky--stuck"),p=!1}var i,j,k=angular.element(b),l=angular.element(c),m="bottom"===f.sticky?"bottom":"top",n=e.offset().top,o=!angular.isDefined(f.usePlaceholder)||f.usePlaceholder?!0:!1,p=!1;e.addClass("util-sticky"),e.addClass("util-sticky-"+m),k.on("scroll",d),k.on("resize",function(){a(d)}),d(),e.bind("$destroy",function(){j&&(j.remove(),j=null)})})}}}]),angular.module("regCartApp").directive("validationMessage",["$compile",function(a){return{restrict:"CAE",scope:{data:"=message",course:"=?"},controller:["$scope","VALIDATION_ERROR_TYPE","GENERAL_ERROR_TYPE","MessageService","RegUtil",function(a,b,c,d,e){function f(a,b){var c=h(a.messageKey),d=[];if(a.courseCode&&d.push({masterLprId:a.masterLprId,courseCode:a.courseCode}),a.conflictingCourses)for(var e=0;e<a.conflictingCourses.length;e++)d.push(a.conflictingCourses[e]);if(d.length){var f=null,g=[],i=[];b&&(angular.isDefined(b.cartItemId)?f=b.cartItemId:angular.isDefined(b.masterLprId)&&(f=b.masterLprId));for(var j=0;j<d.length;j++){if(d[j].masterLprId){if(d[j].masterLprId===f||i.indexOf(d[j].masterLprId)>=0)continue;i.push(d[j].masterLprId)}d[j].courseCode&&g.push("<strong>"+d[j].courseCode+"</strong>")}g.length&&(c+=" ("+g.join(", ")+")")}return c}function g(a){var c=a.messageKey,d=e.convertStringToDate(a.actionDate),f=e.convertStringToDate(a.startDate),g=e.convertStringToDate(a.endDate);return angular.isDefined(d)&&angular.isDate(d)&&(angular.isDefined(f)&&angular.isDate(f)&&f>d&&(c=b.courseNotOpenEarly),angular.isDefined(g)&&angular.isDate(g)&&d>g&&(c=b.courseNotOpenLate)),h(c)}function h(a){return d.getMessage(a)}function i(b,c){a.courseCode||(angular.isString(c)?a.courseCode=c:angular.isObject(c)&&angular.isDefined(c.courseCode)&&(a.courseCode=c.courseCode)),a.regGroupCode||angular.isObject(c)&&angular.isDefined(c.regGroupCode)&&(a.regGroupCode=c.regGroupCode);for(var d=["{{courseCode}} ({{regGroupCode}})","{{courseCode}} {{regGroupCode}}","{{courseCode}}"],e=0;e<d.length;e++){var f=d[e];if(-1!==b.indexOf(f)){var g="<strong>"+f+"</strong>";-1===b.indexOf(g)&&(b=b.replace(f,g));break}}return b}angular.isObject(a.data)&&angular.extend(a,a.data),a.getFormattedMessage=function(){var d="",e=a.data,j=a.course;if(e)if("string"==typeof e)d=e;else if(e.txt)d=e.txt;else if(e.messageKey)switch(e.messageKey){case b.timeConflict:d=f(e,j);break;case b.courseNotOpen:d=g(e);break;case c.noRegGroup:d=i(e.txt,e.course);break;default:d=h(e.messageKey)}return d=i(d,j)}}],link:function(b,c){function d(){var d=b.getFormattedMessage();c.html(d),a(c.contents())(b)}b.$watch("data",d),b.course&&b.$watch("course",d)}}}]);
#created on: May 28, 2008
package agenda

import java.util.Map
import java.util.HashMap

import org.kuali.student.rules.brms.agenda.AgendaRequest
import org.kuali.student.rules.brms.agenda.entity.Agenda
import org.kuali.student.rules.brms.agenda.entity.AgendaType
import org.kuali.student.rules.brms.agenda.entity.BusinessRule
import org.kuali.student.rules.brms.agenda.entity.BusinessRuleType

rule "init"
    salience 999999999
    when
    then
        Map<String,BusinessRuleType> ruleTypeMap = new HashMap<String,BusinessRuleType>();

        BusinessRuleType ruleType1 = new BusinessRuleType( "course.pre.req", "course.pre.req" );
        ruleTypeMap.put( ruleType1.getName(), ruleType1 ); 

        BusinessRuleType ruleType2 = new BusinessRuleType( "course.co.req", "course.co.req" );
        ruleTypeMap.put( ruleType2.getName(), ruleType2 ); 

        BusinessRuleType ruleType3 = new BusinessRuleType( "course.anti.req", "course.anti.req" );
        ruleTypeMap.put( ruleType3.getName(), ruleType3 ); 
        insert( ruleTypeMap );
end

rule "Student Plans Course"
	when
		$request : AgendaRequest( luiPersonRelationType == "kuali.student", 
		                          luType == "course",
		                          luiStatus == "offered",
		                          relationState == "planned" )
        $ruleTypeMap : Map()
	then 
        AgendaType agendaType = new AgendaType( "Student Plans Course", "student.planning.course" );
        agendaType.addBusinessRuleType( (BusinessRuleType) $ruleTypeMap.get( "course.pre.req" ) );
        agendaType.addBusinessRuleType( (BusinessRuleType) $ruleTypeMap.get( "course.co.req" ) );
        insert( agendaType );
end

rule "Student Enrolls in Course"
    when
        $request : AgendaRequest( luiPersonRelationType == "kuali.student", 
                                  luType == "course",
                                  luiStatus == "offered",
                                  relationState == "enrolled" )
        $ruleTypeMap : Map()
    then 
        AgendaType agendaType = new AgendaType( "Student Enrolls in Course", "student.enrollment.course" );
        agendaType.addBusinessRuleType( (BusinessRuleType) $ruleTypeMap.get( "course.pre.req" ) );
        agendaType.addBusinessRuleType( (BusinessRuleType) $ruleTypeMap.get( "course.co.req" ) );
        agendaType.addBusinessRuleType( (BusinessRuleType) $ruleTypeMap.get( "course.anti.req" ) );
        insert( agendaType );
end

rule "Student Completes Course"
    when
        $request : AgendaRequest( luiPersonRelationType == "kuali.student", 
                                  luType == "course",
                                  luiStatus == "offered",
                                  relationState == "complete" )
        $ruleTypeMap : Map()
    then 
        AgendaType agendaType = new AgendaType( "Student Completes Course", "student.complete.course" );
        agendaType.addBusinessRuleType( (BusinessRuleType) $ruleTypeMap.get( "course.pre.req" ) );
        agendaType.addBusinessRuleType( (BusinessRuleType) $ruleTypeMap.get( "course.co.req" ) );
        insert( agendaType );
end


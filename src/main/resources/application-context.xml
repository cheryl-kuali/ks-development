<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:jee="http://www.springframework.org/schema/jee"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="
			http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
			http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
			http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
			http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.5.xsd
			http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd">


	<context:property-placeholder
		location="classpath:application.properties" />

	<!-- web service clients  -->

	<bean id="personClient"
		class="org.kuali.student.poc.common.ws.beans.JaxWsClientFactoryBean">
		<property name="wsdlLocation"
			value="classpath:wsdl/PersonService.wsdl" />
		<property name="serviceEndpointInterface"
			value="org.kuali.student.poc.wsdl.personidentity.person.PersonService" />
		<property name="serviceQNameString"
			value="{http://student.kuali.org/poc/wsdl/personidentity/person}PersonService" />
		<property name="address"
			value="${ks.servicelocation.PersonService}" />
	</bean>

	<bean id="luClient"
		class="org.kuali.student.poc.common.ws.beans.JaxWsClientFactoryBean">
		<property name="wsdlLocation"
			value="classpath:wsdl/LuService.wsdl" />
		<property name="serviceEndpointInterface"
			value="org.kuali.student.poc.wsdl.learningunit.lu.LuService" />
		<property name="serviceQNameString"
			value="{http://student.kuali.org/poc/wsdl/learningunit/lu}LuService" />
		<property name="address"
			value="${ks.servicelocation.LuService}" />
	</bean>

	<!-- web service implementations -->

	<bean id="personServiceImpl"
		class="org.kuali.student.poc.personidentity.person.service.PersonServiceImpl">
		<property name="personDAO">
			<bean id="personDAO"
				class="org.kuali.student.poc.personidentity.person.dao.PersonDAOImpl">
			</bean>
		</property>
	</bean>

	<bean id="luServiceImpl"
		class="org.kuali.student.poc.learningunit.lu.service.impl.LuServiceImpl">
		<property name="dao">
			<bean id="luDao"
				class="org.kuali.student.poc.learningunit.lu.dao.impl.LuDaoImpl">
			</bean>
		</property>
	</bean>

	<bean id="lprServiceImpl"
		class="org.kuali.student.poc.learningunit.luipersonrelation.service.LuiPersonRelationServiceImpl">
		<property name="dao">
			<bean id="lprDao"
				class="org.kuali.student.poc.learningunit.luipersonrelation.dao.impl.LuiPersonRelationDAOImpl">
			</bean>
		</property>
		<property name="luClient" ref="luClient" />
		<property name="personClient" ref="personClient" />
	</bean>

	<!-- jpa / jta -->

	<bean id="dataSource"
		class="com.atomikos.jdbc.AtomikosDataSourceBean" init-method="init"
		destroy-method="close">
		<property name="uniqueResourceName" value="dataSource" />
		<property name="xaDataSourceClassName"
			value="${jdbc.xaDataSourceClassName}" />
		<property name="xaProperties">
			<props>
				<prop key="databaseName">
					${jdbc.xaDataSourceProperties.databaseName}
				</prop>
				<prop key="user">
					${jdbc.xaDataSourceProperties.user}
				</prop>
				<prop key="password">
					${jdbc.xaDataSourceProperties.password}
				</prop>
				<prop key="createDatabase">
					${jdbc.xaDataSourceProperties.createDatabase}
				</prop>
			</props>
		</property>
		<property name="maxPoolSize" value="10" />
	</bean>

	<bean id="jpaVendorAdapter" class="${jpa.adapter}">
		<property name="databasePlatform" value="${jpa.platform}" />
		<property name="showSql" value="${jpa.showSql}" />
		<property name="generateDdl" value="${jpa.generateDdl}" />
	</bean>

	<bean id="personEntityManagerFactory"
		class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
		<property name="jpaVendorAdapter" ref="jpaVendorAdapter" />
		<property name="persistenceXmlLocation"
			value="classpath:META-INF/person-persistence.xml" />
		<property name="dataSource" ref="dataSource" />
		<property name="jpaPropertyMap">
			<map>
				<entry key="hibernate.connection.release_mode"
					value="auto" />
				<entry key="hibernate.transaction.manager_lookup_class"
					value="com.atomikos.icatch.jta.hibernate3.TransactionManagerLookup" />
				<entry key="hibernate.default_schema"
					value="${ks.schema.person}" />
			</map>
		</property>
	</bean>

	<bean id="luEntityManagerFactory"
		class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
		<property name="jpaVendorAdapter" ref="jpaVendorAdapter" />
		<property name="persistenceXmlLocation"
			value="classpath:META-INF/lu-persistence.xml" />
		<property name="dataSource" ref="dataSource" />
		<property name="jpaPropertyMap">
			<map>
				<entry key="hibernate.transaction.manager_lookup_class"
					value="com.atomikos.icatch.jta.hibernate3.TransactionManagerLookup" />
				<entry key="hibernate.default_schema"
					value="${ks.schema.lu}" />
			</map>
		</property>
	</bean>

	<bean id="luprEntityManagerFactory"
		class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
		<property name="jpaVendorAdapter" ref="jpaVendorAdapter" />
		<property name="persistenceXmlLocation"
			value="classpath:META-INF/luipersonrelation-persistence.xml" />
		<property name="dataSource" ref="dataSource" />
		<property name="jpaPropertyMap">
			<map>
				<entry key="hibernate.transaction.manager_lookup_class"
					value="com.atomikos.icatch.jta.hibernate3.TransactionManagerLookup" />
				<entry key="hibernate.default_schema"
					value="${ks.schema.lupr}" />
			</map>
		</property>
	</bean>

	<bean id="AtomikosTxMgr"
		class="com.atomikos.icatch.jta.UserTransactionManager"
		init-method="init" destroy-method="close">
		<property name="forceShutdown" value="true" />
		<property name="startupTransactionService" value="true" />
		<property name="transactionTimeout" value="60" />
	</bean>

	<bean id="AtomikosUsrTx"
		class="com.atomikos.icatch.jta.UserTransactionImp" />

	<bean id="JtaTxManager"
		class="org.springframework.transaction.jta.JtaTransactionManager">
		<property name="transactionManager" ref="AtomikosTxMgr" />
		<property name="userTransaction" ref="AtomikosUsrTx" />
		<property name="transactionSynchronizationName"
			value="SYNCHRONIZATION_ON_ACTUAL_TRANSACTION" />
	</bean>

	<bean
		class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor" />

	<tx:annotation-driven transaction-manager="JtaTxManager" />

	<!-- Exception mapping aop -->

	<aop:aspectj-autoproxy proxy-target-class="true" />

	<bean id="mapExceptionAdvisor"
		class="org.kuali.student.poc.common.util.ExceptionMappingAdvice">
		<property name="defaultException"
			value="org.kuali.student.poc.common.ws.exceptions.OperationFailedException" />
		<property name="exceptionMapping">
			<map>
				<entry key="javax.persistence.EntityExistsException"
					value="org.kuali.student.poc.common.ws.exceptions.AlreadyExistsException" />
				<entry
					key="org.hibernate.exception.ConstraintViolationException"
					value="org.kuali.student.poc.common.ws.exceptions.AlreadyExistsException" />
			</map>
		</property>
	</bean>
	<aop:config>
		<aop:aspect id="dataAccessToBusinessException"
			ref="mapExceptionAdvisor">
			<aop:after-throwing
				pointcut="execution(* org.kuali.student.poc.personidentity.person.service.*.*(..))"
				method="afterThrowing" throwing="ex" />
		</aop:aspect>
	</aop:config>

	<!-- Preloaded beans -->
	<bean id="preloadBeans"
		class="org.kuali.student.poc.common.util.jpa.LoadJpaBeanListener">
		<property name="loadJpaBean">
			<bean
				class="org.kuali.student.poc.common.util.jpa.LoadJpaBean" />
		</property>
		<property name="preloadMap">
			<map>
				<entry key="Lu">
					<ref bean="luBeanPreloadList" />
				</entry>
				<entry key="Person">
					<ref bean="personBeanPreloadList" />
				</entry>
			</map>
		</property>
	</bean>

	<bean id="luBeanPreloadList"
		class="org.springframework.beans.factory.config.ListFactoryBean">
		<property name="sourceList">
			<list>
				<ref bean="atp1" />
				<ref bean="atpStart" />
				<ref bean="atpEnd" />
				<ref bean="luType_credit_course" />
				<ref bean="clu_math100" />
				<ref bean="clu_cmsc214" />
				<ref bean="clu_musc300" />
				<ref bean="lui_math100_0101" />
				<ref bean="lui_cmsc214_0101" />
				<ref bean="lui_musc300_0101" />
				<ref bean="lui_math100_0202" />
			</list>
		</property>
	</bean>
	<bean id="atp1"
		class="org.kuali.student.poc.learningunit.lu.entity.Atp">
		<property name="atpId"
			value="11223344-1122-1122-1111-000000000000" />
		<property name="atpName" value="Fall 2008" />
	</bean>
	<bean id="atpStart"
		class="org.kuali.student.poc.learningunit.lu.entity.Atp">
		<property name="atpId"
			value="11223344-1122-1122-1111-000000000001" />
		<property name="atpName" value="Spring 1890" />
	</bean>
	<bean id="atpEnd"
		class="org.kuali.student.poc.learningunit.lu.entity.Atp">
		<property name="atpId"
			value="11223344-1122-1122-1111-000000000002" />
		<property name="atpName" value="Summer 2040" />
	</bean>
	<bean id="currentTime" class="java.util.Date" />
	<bean id="luType_credit_course"
		class="org.kuali.student.poc.learningunit.lu.entity.LuType">
		<property name="luTypeId"
			value="11223344-1122-1122-1111-000000000003" />
		<property name="description" value="Credit Course" />
		<property name="createTime" ref="currentTime" />
		<property name="createUserComment" value="Created" />
		<property name="createUserId" value="USER-12345" />
		<property name="updateTime" ref="currentTime" />
		<property name="updateUserComment" value="Updated" />
		<property name="updateUserId" value="USER-12345" />
		<property name="luAttributeTypes">
			<set>
				<ref bean="luAttrTyp_credits" />
				<ref bean="luAttrTyp_grading_method" />
			</set>
		</property>
	</bean>
	<bean id="luAttrTyp_credits"
		class="org.kuali.student.poc.learningunit.lu.entity.LuAttributeType">
		<property name="id"
			value="11223344-1122-1122-1111-000000000004" />
		<property name="name" value="Credits" />
		<property name="luTypes">
			<set>
				<ref bean="luType_credit_course" />
			</set>
		</property>
	</bean>
	<bean id="luAttrTyp_grading_method"
		class="org.kuali.student.poc.learningunit.lu.entity.LuAttributeType">
		<property name="id"
			value="11223344-1122-1122-1111-000000000005" />
		<property name="name" value="Grading Method" />
		<property name="luTypes">
			<set>
				<ref bean="luType_credit_course" />
			</set>
		</property>
	</bean>
	<bean id="clu_math100"
		class="org.kuali.student.poc.learningunit.lu.entity.Clu">
		<property name="cluId"
			value="11223344-1122-1122-1111-000000000006" />
		<property name="attributes">
			<set>
				<bean
					class="org.kuali.student.poc.learningunit.lu.entity.LuAttribute">
					<property name="luAttributeType"
						ref="luAttrTyp_credits" />
					<property name="value" value="3" />
					<property name="clu" ref="clu_math100" />
				</bean>
				<bean
					class="org.kuali.student.poc.learningunit.lu.entity.LuAttribute">
					<property name="luAttributeType"
						ref="luAttrTyp_grading_method" />
					<property name="value"
						value="STANDARD, PASS/FAIL, AUDIT" />
					<property name="clu" ref="clu_math100" />
				</bean>
			</set>
		</property>
		<property name="effectiveStartCycle" ref="atpStart" />
		<property name="effectiveEndCycle" ref="atpEnd" />
		<property name="effectiveStartDate" ref="currentTime" />
		<property name="effectiveEndDate" ref="currentTime" />
		<property name="cluLongName" value="College Algebra" />
		<property name="cluShortName" value="MATH100" />
		<property name="description"
			value="Course Description for MATH100" />
		<property name="luType" ref="luType_credit_course" />
	</bean>
	<bean id="clu_cmsc214"
		class="org.kuali.student.poc.learningunit.lu.entity.Clu">
		<property name="cluId"
			value="11223344-1122-1122-1111-000000000007" />
		<property name="attributes">
			<set>
				<bean
					class="org.kuali.student.poc.learningunit.lu.entity.LuAttribute">
					<property name="luAttributeType"
						ref="luAttrTyp_credits" />
					<property name="value" value="4" />
					<property name="clu" ref="clu_cmsc214" />
				</bean>
				<bean
					class="org.kuali.student.poc.learningunit.lu.entity.LuAttribute">
					<property name="luAttributeType"
						ref="luAttrTyp_grading_method" />
					<property name="value" value="STANDARD" />
					<property name="clu" ref="clu_cmsc214" />
				</bean>
			</set>
		</property>
		<property name="effectiveStartCycle" ref="atpStart" />
		<property name="effectiveEndCycle" ref="atpEnd" />
		<property name="effectiveStartDate" ref="currentTime" />
		<property name="effectiveEndDate" ref="currentTime" />
		<property name="cluLongName" value="Computer Science 2" />
		<property name="cluShortName" value="CMSC214" />
		<property name="description"
			value="Course Description for CMSC214" />
		<property name="luType" ref="luType_credit_course" />
	</bean>
	<bean id="clu_musc300"
		class="org.kuali.student.poc.learningunit.lu.entity.Clu">
		<property name="cluId"
			value="11223344-1122-1122-1111-000000000008" />
		<property name="attributes">
			<set>
				<bean
					class="org.kuali.student.poc.learningunit.lu.entity.LuAttribute">
					<property name="luAttributeType"
						ref="luAttrTyp_credits" />
					<property name="value" value="4" />
					<property name="clu" ref="clu_musc300" />
				</bean>
				<bean
					class="org.kuali.student.poc.learningunit.lu.entity.LuAttribute">
					<property name="luAttributeType"
						ref="luAttrTyp_grading_method" />
					<property name="value" value="STANDARD, AUDIT" />
					<property name="clu" ref="clu_musc300" />
				</bean>
			</set>
		</property>
		<property name="effectiveStartCycle" ref="atpStart" />
		<property name="effectiveEndCycle" ref="atpEnd" />
		<property name="effectiveStartDate" ref="currentTime" />
		<property name="effectiveEndDate" ref="currentTime" />
		<property name="cluLongName" value="Advanced Air Guitar" />
		<property name="cluShortName" value="MUSC300" />
		<property name="description"
			value="Course Description for MUSC300" />
		<property name="luType" ref="luType_credit_course" />
	</bean>
	<bean id="lui_math100_0101"
		class="org.kuali.student.poc.learningunit.lu.entity.Lui">
		<property name="luiId"
			value="11223344-1122-1122-1111-000000000009" />
		<property name="atp" ref="atp1" />
		<property name="clu" ref="clu_math100" />
		<property name="luiCode" value="0101" />
		<property name="maxSeats" value="23" />
	</bean>
	<bean id="lui_math100_0202"
		class="org.kuali.student.poc.learningunit.lu.entity.Lui">
		<property name="luiId"
			value="11223344-1122-1122-1111-000000000010" />
		<property name="atp" ref="atp1" />
		<property name="clu" ref="clu_math100" />
		<property name="luiCode" value="0202" />
		<property name="maxSeats" value="12" />
	</bean>
	<bean id="lui_cmsc214_0101"
		class="org.kuali.student.poc.learningunit.lu.entity.Lui">
		<property name="luiId"
			value="11223344-1122-1122-1111-000000000011" />
		<property name="atp" ref="atp1" />
		<property name="clu" ref="clu_cmsc214" />
		<property name="luiCode" value="0101" />
		<property name="maxSeats" value="20" />
	</bean>
	<bean id="lui_musc300_0101"
		class="org.kuali.student.poc.learningunit.lu.entity.Lui">
		<property name="luiId"
			value="11223344-1122-1122-1111-000000000012" />
		<property name="atp" ref="atp1" />
		<property name="clu" ref="clu_musc300" />
		<property name="luiCode" value="0101" />
		<property name="maxSeats" value="33" />
	</bean>

	<bean id="personBeanPreloadList"
		class="org.springframework.beans.factory.config.ListFactoryBean">
		<property name="sourceList">
			<list>
				<ref bean="personType1" />
				<ref bean="person1" />
			</list>
		</property>
	</bean>
	<bean id="person1"
		class="org.kuali.student.poc.personidentity.person.dao.Person">
		<property name="personalInformation"
			ref="person1PersonalInformation" />
		<property name="personCitizenships">
			<set>
				<ref bean="person1Citizenship" />
			</set>
		</property>
		<property name="personNames">
			<set>
				<ref bean="person1Name" />
			</set>
		</property>
		<property name="personReferenceIds">
			<set>
				<ref bean="person1ReferenceId" />
			</set>
		</property>
		<property name="personTypes">
			<set>
				<ref bean="personType1" />
			</set>
		</property>
		<property name="attributes">
			<set>
				<bean
					class="org.kuali.student.poc.personidentity.person.dao.PersonAttribute">
					<property name="personAttributeType"
						ref="personAttributeType1" />
					<property name="value" value="Value1" />
					<property name="person" ref="person1" />
				</bean>
				<bean
					class="org.kuali.student.poc.personidentity.person.dao.PersonAttribute">
					<property name="personAttributeType"
						ref="personAttributeType2" />
					<property name="value" value="Value2" />
					<property name="person" ref="person1" />
				</bean>
				<bean
					class="org.kuali.student.poc.personidentity.person.dao.PersonAttribute">
					<property name="personAttributeType"
						ref="personAttributeType3" />
					<property name="value" value="Value3" />
					<property name="person" ref="person1" />
				</bean>
				<bean
					class="org.kuali.student.poc.personidentity.person.dao.PersonAttribute">
					<property name="personAttributeType"
						ref="personAttributeType4" />
					<property name="value" value="Value4" />
					<property name="person" ref="person1" />
				</bean>
			</set>
		</property>
	</bean>
	<bean id="person1PersonalInformation"
		class="org.kuali.student.poc.personidentity.person.dao.PersonalInformation">
		<property name="confidential" value="false" />
		<property name="person" ref="person1" />
		<!-- <property name="dateOfBirth" value="" />
			<property name="deceasedDate" value="" />
			<property name="gender" value="F" />
			<property name="maritalStatus" value="" />
			<property name="person" value="" />
			<property name="photo" value="" />
			<property name="primaryLanguageCode" value=" " />
			<property name="secondaryLanguageCode" value="" /> -->
	</bean>
	<bean id="person1Citizenship"
		class="org.kuali.student.poc.personidentity.person.dao.PersonCitizenship">
		<property name="countryOfCitizenship" value="USA" />
		<property name="person" ref="person1" />
	</bean>
	<bean id="person1Name"
		class="org.kuali.student.poc.personidentity.person.dao.PersonName">
		<property name="surname" value="Staley" />
		<property name="givenName" value="Layne" />
		<property name="nameType" value="Prefered" />
		<property name="person" ref="person1" />
	</bean>
	<bean name="person1ReferenceId"
		class="org.kuali.student.poc.personidentity.person.dao.PersonReferenceId">
		<property name="referenceId" value="ABC123" />
		<property name="organizationReferenceId" value="XYZONTV" />
		<property name="person" ref="person1" />
	</bean>
	<bean id="personType1"
		class="org.kuali.student.poc.personidentity.person.dao.PersonType">
		<property name="name" value="PersonType1" />
		<property name="personAttributeSetTypes">
			<set>
				<ref bean="personAttributeSetType1" />
				<ref bean="personAttributeSetType2" />
			</set>
		</property>
	</bean>
	<bean id="personAttributeSetType1"
		class="org.kuali.student.poc.personidentity.person.dao.PersonAttributeSetType">
		<property name="name" value="personAttributeSetType1" />
		<property name="personAttributeTypes">
			<set>
				<ref bean="personAttributeType1" />
				<ref bean="personAttributeType2" />
			</set>
		</property>
	</bean>
	<bean id="personAttributeSetType2"
		class="org.kuali.student.poc.personidentity.person.dao.PersonAttributeSetType">
		<property name="name" value="personAttributeSetType2" />
		<property name="personAttributeTypes">
			<set>
				<ref bean="personAttributeType3" />
				<ref bean="personAttributeType4" />
			</set>
		</property>
	</bean>
	<bean id="personAttributeType1"
		class="org.kuali.student.poc.personidentity.person.dao.PersonAttributeType">
		<property name="name" value="personAttributeType1" />
		<property name="definition"
			value="Display personAttributeType1" />
		<property name="type" value="String" />
	</bean>
	<bean id="personAttributeType2"
		class="org.kuali.student.poc.personidentity.person.dao.PersonAttributeType">
		<property name="name" value="personAttributeType2" />
		<property name="definition"
			value="Display personAttributeType2" />
		<property name="type" value="String" />
	</bean>
	<bean id="personAttributeType3"
		class="org.kuali.student.poc.personidentity.person.dao.PersonAttributeType">
		<property name="name" value="personAttributeType3" />
		<property name="definition"
			value="Display personAttributeType3" />
		<property name="type" value="String" />
	</bean>
	<bean id="personAttributeType4"
		class="org.kuali.student.poc.personidentity.person.dao.PersonAttributeType">
		<property name="name" value="personAttributeType4" />
		<property name="definition"
			value="Display personAttributeType4" />
		<property name="type" value="String" />
	</bean>
</beans>

